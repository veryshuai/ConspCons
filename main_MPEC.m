%temporary main file for conspicuous consumption estimation
clc;
cd '/gpfs/home/dcj138/work/ConspCons/'

warning off all;

%read %create data files

load dat

%open parallel functionality
if matlabpool('size')<12
matlabpool open 12
end

%open diary
diary 2-26-12-2.txt

%linearly extend prices to cover zeros and include only relevant price years
price = price_fixing(price); 
price = price([1,7:12,14:24],:);

%create total expenditures
exp = sum(cons,2);

c = dataset(exp,cons,char);

%drop obs if expenditure less than one dollar/yr
ind = find(exp>1);
less_than_ones = size(exp,1) - size(ind,1);
c = c(ind,:);

%drop obs if any good has negative expenditure
neg_exps = 0;
for k = 1:29
ind = find(c.cons(:,k)>=0);
c = c(ind,:);
neg_exps = neg_exps + size(c.cons(:,k),1)-size(ind,1);
end
display(['Lost ', num2str(less_than_ones), ' expenditures less than one dollar, and further lost ', num2str(neg_exps),' negative expenditure observations']); 

%create year numbers
c.y = zeros(size(c.exp));
c.y(c.char(:,7)==80) = 1;
for k = 2:7
    c.y(c.char(:,7)==84+k) = k;
end
for k = 8:14
    c.y(c.char(:,7)==85+k) = k;
end
for k = 15:18
    c.y(c.char(:,7)==k-15) = k;
end

% create expenditure grid by year [year,grid]
gr_siz = 15;
w_b = zeros(2,18);
egr = cell(18,1);
for k = 1:18
w_b(:,k) = quantile(c.exp(c.y==k),[.1;.2]);
%egr(k,:) = logspace(log(w_b(1,k))/log(10),log(w_b(2,k))/log(10),gr_siz); %logs
egr{k} = linspace(w_b(1,k),w_b(2,k),gr_siz); %linear
end

%create type indices
ti = zeros(size(c,1),4);
ti(:,1) = c.char(:,3)==1 & c.char(:,4) == 1; %bo4
ti(:,2) = c.char(:,3)==1 & c.char(:,4) == 0; %no4
ti(:,3) = c.char(:,3)==0 & c.char(:,4) == 1; %bu4
ti(:,4) = c.char(:,3)==0 & c.char(:,4) == 0; %nu4

%make a type variable
c.type = ti(:,1)+2*ti(:,2) +3*ti(:,3)+4*ti(:,4); 

%create two dimensional consumption array with dimensions year, type, and
%element expenditure share
c = sortrows(c,{'exp'});
ca = cell(18,4);
ce = cell(18,4);
for k = 1:18
    for m = 1:4
       ind = find(c.y==k & c.type==m & c.exp >= w_b(1,k) & c.exp <= w_b(2,k));
        ca{k,m} = c.cons(ind,:)./repmat(c.exp(ind),1,29);
        ce{k,m} = c.exp(ind);
    end
end

%wealth dist calculations, matrix [density,year,type]
% w = zeros(size(egr,2),18,4);
% for j = 1:18
%     for k = 1:4  
%         w(:,j,k) = histc(ce{j,k},egr(j,:))+1e-6; %added a bit to ensure that there are no zeros (full support)
%         w(:,j,k) = w(:,j,k)/sum(w(:,j,k),1); %make it a dist
%     end
% end

%now we need to approximate expenditures with a continuous distribution.
%I choose to fit a polynomial.
w = zeros(4,18,4);
resolution = 30; %number of grid points
freqs = zeros(resolution+1,18,4);
for j = 1:18
    ind_var = linspace(w_b(1,j),w_b(2,j),resolution+1)';
    for k = 1:4
        freqs(:,j,k) = histc(ce{j,k},ind_var);
        w(1:3,j,k) = regress(freqs(1:end-1,j,k),[ind_var(1:end-1).^0,ind_var(1:end-1).^1,ind_var(1:end-1).^2]);
        pred = [ind_var(1:end-1).^0,ind_var(1:end-1).^1,ind_var(1:end-1).^2]*w(1:3,j,k); 
        w(4,j,k) = quad(@(x) w(1,j,k) + w(2,j,k)*x + w(3,j,k)*x.^2,w_b(1,j),w_b(2,j));
    end
end

%v is literally the inverse of the vindex times grid size
v = cell(4,1);
for k = 1:4
    v{k} = vin(k,:).^-1;
end

%Set type number
N = 4;

%set year number
T = 3;

%set scaling for parameters
scl = quantile(c.exp(:),.2)^2;

%number of Sobol points for numeric integral
sobol_num = 5;
s = cell(T,1);
for t = 1:T
    s{t} = sobolset(1);
    s{t} = net(s{t},sobol_num);
    s{t} = egr{t}(1) + (egr{t}(end)-egr{t}(1))*s{t};
    s{t} = sortrows(s{t});
end

%set up global distance variable (so I can use parallel)
%global dis 
%dis = zeros(28*3*T*N,1);

    pop = [
         1.54447903439777,1.35090498391467,1.71215774443687,1.99571402474323,1.59956427070366,1.62990333537302,1.43349917252069,1.61599807942007,1.89624213929275,1.66098877891710,0.989431950197908,1.23980509596797,1.01701377501479,1.67462060190109,1.51144057673234,1.34140602053691,1.31347389253323,1.84232257371854,1.77959246539458,1.84922076404762,1.46794916015857,1.68233352327803,1.47037921706620,1.68965497372164,1.76542216927780,1.98414288985960,1.84862538937963,1.47646744120054,1.90936147698205,1.99756137541823,1.00291957291998,1.99854013426612,1.98773012408360,1.00658066915073,1.00992783438957,1.99510163127061,1.00461488293224,1.99187847011339,1.99284327092363,2.01164880721850,1.99936263434229,1.01173465217151,2.00077500565613,1.03789229361771,1.07271890417482,1.01425497865846,1.99688084024357,1.99306310154848,1.01162819721833,1.03829273760544,1.99320405994165,2.00065424662918,1.99298089170058,1.99371251073292,2.61216685010126,1.99818808734229,1.05190165438408,1.99628691024080,0.113197287991449,0.243412826422788,-0.143109353122232,1.24274502095714,0.978759355566072,0.0533286851845456,0.361363440476037,1.20884965048132,0.368131065099945,0.222431179101056,1.02570143090493,0.0345483226752329,0.658007038275418,1.03865184062610,0.0578895302527899,0.354756919063153,0.553889819609315,-0.269880144742922,0.381857312663827,1.15562873905609,0.0426478573244500,0.774083817892828,0.796132892993759,0.254153069932137,0.0524746404638222,0.805480293314011,0.0586034745091876,0.115363705953246,0.804173901753686,-0.417826832117942,0.368762525689784,1.12323488210978,-0.254467247092692,1.18716035568177,0.990068852835433,-0.411089939786252,0.666272360125503,1.18028986597471,0.0287135444304694,0.895042641848926,0.758737914892543,-0.0782596092514768,1.27745457624036,1.33498453879262,-0.143514426090746,0.938336802443337,0.280017942171674,-0.183532547589751,0.917765877206796,1.05938432242179,0.162946996318822,1.18674348503261,0.850269752345338,0.173693916415967,0.910503061226667,0.968562490005006,0.166792179555094,0.296681072728649,0.636690168954244,-0.0832198938185162,0.0599498631431451,0.526700550295770,0.0810335313404935,0.858681057301290,0.755674674617729,-0.0857682590822649,0.971586244013702,0.516450375711559,0.0774787269209196,0.682708261232628,1.43884945552692,0.168547715369880,0.0313597436771457,1.18538553701278,0.0466625783042915,-0.0531735799396419,0.845140897384135,0.152408327935100,-0.103734232149998,0.850370643106302,-0.144209080958352,0.159466037490574,0.866568836977539,0.209918544833056,0.708222364385790,0.863576483326689,-0.192468536939407,2.12976987460092,0.289282830763791,-0.134289104617116,0.154716386003815,0.999381714271558,0.367265283316788,1.33819478993307,1.23261438044077,-0.124841838577350,0.790274279254423,0.789134073098216,0.0567454624564204,-0.300584890845072,2.33917879758346,-0.329596755201824,0.253593785233492,3.88085497201113,-0.142775742384621,0.836007914079674,0.157345058960241,0.230338329139821,0.915837339241832,0.342912693445439,-0.113007125189593,1.07473150103589,1.97152415254932,-0.431690407931119,0.989862123744413,1.28845125694438,-0.306916429957434,2.28272551805716,-0.379397355515337,-0.352041622821539,1.97170724824648,0.452326334367954,-0.0938467329513327,1.40313136439119,1.08086430232856,-0.226774254382810,-0.447595212902046,1.03944199248298,-0.175387842385941,2.67390452290868,0.496798537236091,-0.234959124962724,0.286585917157684,1.69779988278357,0.0978110773572212,2.04331570057978,-0.379686002159981,0.135243440947481,0.560294484838693,0.998814840605390,0.0891164760163238,1.16621765730185,2.38260392047325,-0.143856990226568,-0.247704950144294,-0.522549805350530,0.0392391914894662,0.379874173935522,-0.366004943714811,-0.139475384229670,0.553937006823907,1.00218914141649,0.0221092299942812,-0.261699158057765,1.91003608362440,0.131703938671409,0.819448435253635,-0.164003638560172,-0.236265992568740,0.121592355567941,0.674258622438856,0.0883810018265194,3.03761815660202,1.53111054133481,-0.157115346763691,1.80296653472805,0.998355910744050,0.139898540072277,-0.691763213396868,0.997799765100640,-0.258242634008486,1.06064462335262,0.241005241367594,0.610634328473931,2.34845125515369,2.55507091331679,0.232077895660953,0.953237162597500,1.00453641227643,2.00396811601158,-0.572775504506041,1.27220125534693,0.218540915775862,2.21075732838307,0.652668011074932,-0.257364050232879,1.17084569872473,2.66393683818336,1.18822962321121,0.118273240508075,2.34321669943230,0.203857293451908,0.418581690745407,1.57399929292222,0.119302952547676,0.839042557533683,1.65997651115495,-0.335612308331859,-0.300833284527368,1.61438427103732,-0.440525087091954,2.43163562239332,1.26071512281767,-0.467632923917958,2.01780063979854,0.393989699193553,0.0804557932890774,0.927220921387201,1.07911389261079,-0.241595454718577,0.332407101436290,0.490200386847502,-0.277844339597666,1.23727598590967,1.18514552824676,-0.413530235327864,2.79095981857526,-1.61021334110114,0.0851371340256563,1.88085500149910,-0.243014572771261,0.0364705846709247,0.219798132269709,0.467401066223431,0.0912421730495570,0.525950799375158,0.430633842904167,-0.546544251587089,-0.452635956409225,1.46191511659248,0.123272966007862,2.07929228250014,0.282188228857519,-0.495828469905154,0.703698303282521,0.517386647742569,0.174407076307457,-0.537990416920113,0.724255646311806,0.126066239658248,-1.20475801660306,0.628270149069416,-0.503290484678807,1.63150777134234,0.265951797193383,0.356845075142463,-2.71130273615517,1.02333034942494,-0.246949047310495,2.39912732077787,0.849435375278039,0.0985699175414592,0.636989624510580,1.00622456299605,-0.187989217748526,-0.138818368926142,1.27253543791993,0.128985121372094,2.07123375961758,1.84252475197790,0.368360327518352,0.939049173087330,0.995929818355728,-0.639743640284997,0.378731406488982,-0.633442710180755,0.187220439601965,0.899358444943677,1.00106721664931,-0.341158582710169,-0.0296374532908222,0.954485038987118,-0.718603127832035,1.57560289031561,-0.113799549949663,0.286736182578409,0.793669493513259,1.13118857795921,-0.506051587399776,-0.306717194791152,1.00946579621842,-2.48124338260514e-05,0.239981927855181,0.368342947887513,-0.369131875259173,-0.670914183779377,2.04445173811030,-0.293748414348049,-1.90034552457013,-1.05936533025640,-0.530028000692723,1.53389675532730,5.41025928225960,-0.298544016941066,1.61765674089918,-0.663669854414629,-0.197491365254731,-0.0857896612570337,1.22137467035313,-0.340188093936813,1.54585389124479,1.17325783566255,0.230339705576606,-1.30987051610662,0.991533295759376,0.191603325414802,0.817935244746254,1.88516195498218,0.0742797707378763,-1.58539353706169,0.856179800294159,-0.363994811460975,2.09952422701923,-2.47506521563510,0.396717575717618,1.51318160964275,0.0378358509618395,-0.355891423057381,2.41552291057632,3.59096808064916,0.348580448319494,1.16061625376247,-0.160770178395780,0.0993807616883239,0.453598796947985,1.52771452009699,-0.694963391987131,1.38702376909677,0.741215036235584,0.000134899823285382,1.17911627403577,0.866050797556824,-0.452435812395579,1.38680369946140,2.25459793815959,0.287328634374393,2.47221574261419,0.806439603604558...
         -0.143109353122232,1.24274502095714,0.978759355566072,0.0533286851845456,0.361363440476037,1.20884965048132,0.368131065099945,0.222431179101056,1.02570143090493,0.0345483226752329,0.658007038275418,1.03865184062610,0.0578895302527899,0.354756919063153,0.553889819609315,-0.269880144742922,0.381857312663827,1.15562873905609,0.0426478573244500,0.774083817892828,0.796132892993759,0.254153069932137,0.0524746404638222,0.805480293314011,0.0586034745091876,0.115363705953246,0.804173901753686,-0.417826832117942,0.368762525689784,1.12323488210978,-0.254467247092692,1.18716035568177,0.990068852835433,-0.411089939786252,0.666272360125503,1.18028986597471,0.0287135444304694,0.895042641848926,0.758737914892543,-0.0782596092514768,1.27745457624036,1.33498453879262,-0.143514426090746,0.938336802443337,0.280017942171674,-0.183532547589751,0.917765877206796,1.05938432242179,0.162946996318822,1.18674348503261,0.850269752345338,0.173693916415967,0.910503061226667,0.968562490005006,0.166792179555094,0.296681072728649,0.636690168954244,-0.0832198938185162,0.0599498631431451,0.526700550295770,0.0810335313404935,0.858681057301290,0.755674674617729,-0.0857682590822649,0.971586244013702,0.516450375711559,0.0774787269209196,0.682708261232628,1.43884945552692,0.168547715369880,0.0313597436771457,1.18538553701278,0.0466625783042915,-0.0531735799396419,0.845140897384135,0.152408327935100,-0.103734232149998,0.850370643106302,-0.144209080958352,0.159466037490574,0.866568836977539,0.209918544833056,0.708222364385790,0.863576483326689,-0.192468536939407,2.12976987460092,0.289282830763791,-0.134289104617116,0.154716386003815,0.999381714271558,0.367265283316788,1.33819478993307,1.23261438044077,-0.124841838577350,0.790274279254423,0.789134073098216,0.0567454624564204,-0.300584890845072,2.33917879758346,-0.329596755201824,0.253593785233492,3.88085497201113,-0.142775742384621,0.836007914079674,0.157345058960241,0.230338329139821,0.915837339241832,0.342912693445439,-0.113007125189593,1.07473150103589,1.97152415254932,-0.431690407931119,0.989862123744413,1.28845125694438,-0.306916429957434,2.28272551805716,-0.379397355515337,-0.352041622821539,1.97170724824648,0.452326334367954,-0.0938467329513327,1.40313136439119,1.08086430232856,-0.226774254382810,-0.447595212902046,1.03944199248298,-0.175387842385941,2.67390452290868,0.496798537236091,-0.234959124962724,0.286585917157684,1.69779988278357,0.0978110773572212,2.04331570057978,-0.379686002159981,0.135243440947481,0.560294484838693,0.998814840605390,0.0891164760163238,1.16621765730185,2.38260392047325,-0.143856990226568,-0.247704950144294,-0.522549805350530,0.0392391914894662,0.379874173935522,-0.366004943714811,-0.139475384229670,0.553937006823907,1.00218914141649,0.0221092299942812,-0.261699158057765,1.91003608362440,0.131703938671409,0.819448435253635,-0.164003638560172,-0.236265992568740,0.121592355567941,0.674258622438856,0.0883810018265194,3.03761815660202,1.53111054133481,-0.157115346763691,1.80296653472805,0.998355910744050,0.139898540072277,-0.691763213396868,0.997799765100640,-0.258242634008486,1.06064462335262,0.241005241367594,0.610634328473931,2.34845125515369,2.55507091331679,0.232077895660953,0.953237162597500,1.00453641227643,2.00396811601158,-0.572775504506041,1.27220125534693,0.218540915775862,2.21075732838307,0.652668011074932,-0.257364050232879,1.17084569872473,2.66393683818336,1.18822962321121,0.118273240508075,2.34321669943230,0.203857293451908,0.418581690745407,1.57399929292222,0.119302952547676,0.839042557533683,1.65997651115495,-0.335612308331859,-0.300833284527368,1.61438427103732,-0.440525087091954,2.43163562239332,1.26071512281767,-0.467632923917958,2.01780063979854,0.393989699193553,0.0804557932890774,0.927220921387201,1.07911389261079,-0.241595454718577,0.332407101436290,0.490200386847502,-0.277844339597666,1.23727598590967,1.18514552824676,-0.413530235327864,2.79095981857526,-1.61021334110114,0.0851371340256563,1.88085500149910,-0.243014572771261,0.0364705846709247,0.219798132269709,0.467401066223431,0.0912421730495570,0.525950799375158,0.430633842904167,-0.546544251587089,-0.452635956409225,1.46191511659248,0.123272966007862,2.07929228250014,0.282188228857519,-0.495828469905154,0.703698303282521,0.517386647742569,0.174407076307457,-0.537990416920113,0.724255646311806,0.126066239658248,-1.20475801660306,0.628270149069416,-0.503290484678807,1.63150777134234,0.265951797193383,0.356845075142463,-2.71130273615517,1.02333034942494,-0.246949047310495,2.39912732077787,0.849435375278039,0.0985699175414592,0.636989624510580,1.00622456299605,-0.187989217748526,-0.138818368926142,1.27253543791993,0.128985121372094,2.07123375961758,1.84252475197790,0.368360327518352,0.939049173087330,0.995929818355728,-0.639743640284997,0.378731406488982,-0.633442710180755,0.187220439601965,0.899358444943677,1.00106721664931,-0.341158582710169,-0.0296374532908222,0.954485038987118,-0.718603127832035,1.57560289031561,-0.113799549949663,0.286736182578409,0.793669493513259,1.13118857795921,-0.506051587399776,-0.306717194791152,1.00946579621842,-2.48124338260514e-05,0.239981927855181,0.368342947887513,-0.369131875259173,-0.670914183779377,2.04445173811030,-0.293748414348049,-1.90034552457013,-1.05936533025640,-0.530028000692723,1.53389675532730,5.41025928225960,-0.298544016941066,1.61765674089918,-0.663669854414629,-0.197491365254731,-0.0857896612570337,1.22137467035313,-0.340188093936813,1.54585389124479,1.17325783566255,0.230339705576606,-1.30987051610662,0.991533295759376,0.191603325414802,0.817935244746254,1.88516195498218,0.0742797707378763,-1.58539353706169,0.856179800294159,-0.363994811460975,2.09952422701923,-2.47506521563510,0.396717575717618,1.51318160964275,0.0378358509618395,-0.355891423057381,2.41552291057632,3.59096808064916,0.348580448319494,1.16061625376247,-0.160770178395780,0.0993807616883239,0.453598796947985,1.52771452009699,-0.694963391987131,1.38702376909677,0.741215036235584,0.000134899823285382,1.17911627403577,0.866050797556824,-0.452435812395579,1.38680369946140,2.25459793815959,0.287328634374393,2.47221574261419,0.806439603604558...
         -0.143109353122232,1.24274502095714,0.978759355566072,0.0533286851845456,0.361363440476037,1.20884965048132,0.368131065099945,0.222431179101056,1.02570143090493,0.0345483226752329,0.658007038275418,1.03865184062610,0.0578895302527899,0.354756919063153,0.553889819609315,-0.269880144742922,0.381857312663827,1.15562873905609,0.0426478573244500,0.774083817892828,0.796132892993759,0.254153069932137,0.0524746404638222,0.805480293314011,0.0586034745091876,0.115363705953246,0.804173901753686,-0.417826832117942,0.368762525689784,1.12323488210978,-0.254467247092692,1.18716035568177,0.990068852835433,-0.411089939786252,0.666272360125503,1.18028986597471,0.0287135444304694,0.895042641848926,0.758737914892543,-0.0782596092514768,1.27745457624036,1.33498453879262,-0.143514426090746,0.938336802443337,0.280017942171674,-0.183532547589751,0.917765877206796,1.05938432242179,0.162946996318822,1.18674348503261,0.850269752345338,0.173693916415967,0.910503061226667,0.968562490005006,0.166792179555094,0.296681072728649,0.636690168954244,-0.0832198938185162,0.0599498631431451,0.526700550295770,0.0810335313404935,0.858681057301290,0.755674674617729,-0.0857682590822649,0.971586244013702,0.516450375711559,0.0774787269209196,0.682708261232628,1.43884945552692,0.168547715369880,0.0313597436771457,1.18538553701278,0.0466625783042915,-0.0531735799396419,0.845140897384135,0.152408327935100,-0.103734232149998,0.850370643106302,-0.144209080958352,0.159466037490574,0.866568836977539,0.209918544833056,0.708222364385790,0.863576483326689,-0.192468536939407,2.12976987460092,0.289282830763791,-0.134289104617116,0.154716386003815,0.999381714271558,0.367265283316788,1.33819478993307,1.23261438044077,-0.124841838577350,0.790274279254423,0.789134073098216,0.0567454624564204,-0.300584890845072,2.33917879758346,-0.329596755201824,0.253593785233492,3.88085497201113,-0.142775742384621,0.836007914079674,0.157345058960241,0.230338329139821,0.915837339241832,0.342912693445439,-0.113007125189593,1.07473150103589,1.97152415254932,-0.431690407931119,0.989862123744413,1.28845125694438,-0.306916429957434,2.28272551805716,-0.379397355515337,-0.352041622821539,1.97170724824648,0.452326334367954,-0.0938467329513327,1.40313136439119,1.08086430232856,-0.226774254382810,-0.447595212902046,1.03944199248298,-0.175387842385941,2.67390452290868,0.496798537236091,-0.234959124962724,0.286585917157684,1.69779988278357,0.0978110773572212,2.04331570057978,-0.379686002159981,0.135243440947481,0.560294484838693,0.998814840605390,0.0891164760163238,1.16621765730185,2.38260392047325,-0.143856990226568,-0.247704950144294,-0.522549805350530,0.0392391914894662,0.379874173935522,-0.366004943714811,-0.139475384229670,0.553937006823907,1.00218914141649,0.0221092299942812,-0.261699158057765,1.91003608362440,0.131703938671409,0.819448435253635,-0.164003638560172,-0.236265992568740,0.121592355567941,0.674258622438856,0.0883810018265194,3.03761815660202,1.53111054133481,-0.157115346763691,1.80296653472805,0.998355910744050,0.139898540072277,-0.691763213396868,0.997799765100640,-0.258242634008486,1.06064462335262,0.241005241367594,0.610634328473931,2.34845125515369,2.55507091331679,0.232077895660953,0.953237162597500,1.00453641227643,2.00396811601158,-0.572775504506041,1.27220125534693,0.218540915775862,2.21075732838307,0.652668011074932,-0.257364050232879,1.17084569872473,2.66393683818336,1.18822962321121,0.118273240508075,2.34321669943230,0.203857293451908,0.418581690745407,1.57399929292222,0.119302952547676,0.839042557533683,1.65997651115495,-0.335612308331859,-0.300833284527368,1.61438427103732,-0.440525087091954,2.43163562239332,1.26071512281767,-0.467632923917958,2.01780063979854,0.393989699193553,0.0804557932890774,0.927220921387201,1.07911389261079,-0.241595454718577,0.332407101436290,0.490200386847502,-0.277844339597666,1.23727598590967,1.18514552824676,-0.413530235327864,2.79095981857526,-1.61021334110114,0.0851371340256563,1.88085500149910,-0.243014572771261,0.0364705846709247,0.219798132269709,0.467401066223431,0.0912421730495570,0.525950799375158,0.430633842904167,-0.546544251587089,-0.452635956409225,1.46191511659248,0.123272966007862,2.07929228250014,0.282188228857519,-0.495828469905154,0.703698303282521,0.517386647742569,0.174407076307457,-0.537990416920113,0.724255646311806,0.126066239658248,-1.20475801660306,0.628270149069416,-0.503290484678807,1.63150777134234,0.265951797193383,0.356845075142463,-2.71130273615517,1.02333034942494,-0.246949047310495,2.39912732077787,0.849435375278039,0.0985699175414592,0.636989624510580,1.00622456299605,-0.187989217748526,-0.138818368926142,1.27253543791993,0.128985121372094,2.07123375961758,1.84252475197790,0.368360327518352,0.939049173087330,0.995929818355728,-0.639743640284997,0.378731406488982,-0.633442710180755,0.187220439601965,0.899358444943677,1.00106721664931,-0.341158582710169,-0.0296374532908222,0.954485038987118,-0.718603127832035,1.57560289031561,-0.113799549949663,0.286736182578409,0.793669493513259,1.13118857795921,-0.506051587399776,-0.306717194791152,1.00946579621842,-2.48124338260514e-05,0.239981927855181,0.368342947887513,-0.369131875259173,-0.670914183779377,2.04445173811030,-0.293748414348049,-1.90034552457013,-1.05936533025640,-0.530028000692723,1.53389675532730,5.41025928225960,-0.298544016941066,1.61765674089918,-0.663669854414629,-0.197491365254731,-0.0857896612570337,1.22137467035313,-0.340188093936813,1.54585389124479,1.17325783566255,0.230339705576606,-1.30987051610662,0.991533295759376,0.191603325414802,0.817935244746254,1.88516195498218,0.0742797707378763,-1.58539353706169,0.856179800294159,-0.363994811460975,2.09952422701923,-2.47506521563510,0.396717575717618,1.51318160964275,0.0378358509618395,-0.355891423057381,2.41552291057632,3.59096808064916,0.348580448319494,1.16061625376247,-0.160770178395780,0.0993807616883239,0.453598796947985,1.52771452009699,-0.694963391987131,1.38702376909677,0.741215036235584,0.000134899823285382,1.17911627403577,0.866050797556824,-0.452435812395579,1.38680369946140,2.25459793815959,0.287328634374393,2.47221574261419,0.806439603604558;...
         
         %0.817206133933687,1.58915404567232,1.58698793163414,1.14380243399119,1.64938322770057,1.32076709318327,1.26594358607647,1.43946738909447,1.24734846885505,1.52559798937732,1.61948801321732,1.33467317754811,1.54329064987771,1.63184917059475,1.47603705164619,1.59671950735345,1.34884944047852,1.84129658974103,1.19932267541589,1.85701047874604,1.41784635491442,1.58691840421046,1.49661213552782,1.62080127816717,1.21138473793763,1.98447677852684,1.85208376316114,1.37224318501192,1.82237593346394,0.990301901657347,1.00288729601342,0.802935687873229,0.995412668461307,1.00650750562058,1.00981531725230,0.979970415273278,1.00456438401385,0.973039693451945,0.997478734095259,0.989369601085482,0.995454734746468,1.01160359547953,0.968694501183257,1.03738713084798,1.07170689688745,1.01409501795020,0.976449242279532,0.991915284850660,1.01149689631704,1.03786230599987,0.963191971334168,0.996035501548351,0.993517354377371,0.971616104323755,0.435707030156423,0.955593329374765,1.03753783667691,0.941642957680005,0.00292739323262019,0.480424140583850,0.670418061827606,1.24517722478501,0.981062963077433,0.672992138891207,0.364944500920036,1.20874957243999,0.338260770618901,0.221355195311438,1.02787611392428,0.708899020492483,0.659810355882155,1.04081944604346,0.478297537277598,0.354161891213899,0.553674162463550,0.435769331934802,0.386483121096072,1.15507892470249,0.571665678069175,0.778204674460036,0.795496254307882,0.426756897235799,0.0569029521876310,0.807970259162437,0.629448759382519,0.119086519128183,0.807963133964888,0.690798560270284,0.368862550727392,1.12523108503629,0.489381340050174,1.19108050140030,0.988960860444712,0.641225088730975,0.670452469454374,1.17961927169794,0.688436423105298,0.898090238697290,0.759544162042033,0.594340517029963,1.28099263122762,1.33455622045235,0.677324853105178,0.942980291891560,0.279387523950965,0.507619502619260,0.922799798239319,1.05603042501923,0.818041602827406,1.19080865852084,0.847416507630558,0.384865066366596,0.913050917287164,0.972137736124902,0.827279270136183,0.298663565618506,0.636728227186840,0.555117686331448,0.0598124192581770,0.529376922325898,0.671106814037196,0.863436577527380,0.758029202690462,0.611479495098432,0.971616601749536,0.515846115442612,0.691898426304148,0.684507797070860,1.43831592929058,0.398070822715963,0.0328302565669299,1.18481024586125,0.836723144625061,-0.0516772264531030,0.847352094272246,0.826189422236424,-0.105512697765214,0.846365408441857,0.526628138232403,0.161486800617738,0.865365078873593,0.801671142283992,0.706276488468212,0.865500728934574,0.670315216946337,2.13013497321703,0.289450662313102,0.673010325955733,0.156605979910572,1.00045562423556,0.338135185840333,1.33884082393192,1.23293311411373,0.708867432361628,0.791945192230439,0.789387828074182,0.478334001453575,-0.298584890985885,2.33907261131221,0.435756504479125,0.254231487680861,3.88062205574044,0.571640022676767,0.839074844899837,0.156788550266895,0.426670739070957,0.915583547374213,0.343200504056374,0.629343066877680,1.07613767478194,1.97102818178135,0.690725477145694,0.993203052662525,1.28885429356975,0.489258221344066,2.28315006534872,-0.378787916669274,0.641086773407572,1.97219587892735,0.452771972083707,0.688367987260099,1.40336152010533,1.08181393547872,0.594488723022758,-0.447659571575859,1.03975220882382,0.677143470205304,2.67389197424791,0.497411201094438,0.507659360900207,0.288100321167706,1.69776347979309,0.817945790854970,2.04343748087757,-0.378988410078666,0.384881052809646,0.561211036929328,0.999982588806336,0.827280324175885,1.16676362974257,2.38227310433526,0.555128422098457,-0.247428724012722,-0.522299076868366,0.671135910797181,0.381298950382990,-0.366271146344651,0.611498550278208,0.556418828037888,1.00156001381339,0.691969497107258,-0.261137147544964,1.91022220974334,0.397976497157354,0.820145417645886,-0.162871003341001,0.836666419128191,0.122025917202171,0.674581711116539,0.825883737272460,3.03769925700234,1.53114828955720,0.526453737957591,1.80423004283615,0.998868137860049,0.801644685077759,-0.680513073034380,0.999594267133113,0.669747744593307,1.05727722512519,0.215548901850032,0.672149144794515,2.33421441259660,2.55464043080821,0.337852299869898,0.941592091104951,0.993976629095979,0.708237809512107,-0.562639444370708,1.24517035787340,0.478563384784418,2.19771732696529,0.649532022472923,0.435309051606011,1.17107648501627,2.65291431757049,0.568679894889826,0.0981901245949871,2.34099366910845,0.425836722726434,0.410268749284230,1.56970875471968,0.628607118629838,0.815054036233338,1.66407388084626,0.689747782505934,-0.313039711394072,1.60551214188975,0.489174713652023,2.42101376562730,1.25593070709514,0.640274930722392,2.01320969570403,0.389157201130293,0.691103158322762,0.927134175211890,1.06919868206772,0.594344873606428,0.312799298565069,0.475979754435316,0.676191447585121,1.23042562488585,1.17863039314645,0.506214585637749,2.78765376592347,-1.61160724113235,0.817415043600388,1.88261836605063,-0.254849202667173,0.383738475227666,0.213542869122029,0.473505582002037,0.826768570044584,0.517755600520325,0.431974277015129,0.557161815977994,-0.479903091682180,1.46457895474592,0.669809862356739,2.07187058694273,0.291461766906170,0.609861338920188,0.702277772458981,0.525578947393398,0.690584553870709,-0.542570279683591,0.760480274761446,0.396807936087706,-1.20805273747624,0.627223707437748,0.858496504668548,1.65859958017339,0.263341347246510,0.825854595034260,-2.71456624840873,0.996805272482457,0.525211233753804,2.39787741637672,0.848255359328492,0.803362925345974,0.627481522541179,0.998065800000515,0.669913078836793,-0.150389628167342,1.27260560334509,0.672320658652798,2.06981678535671,1.84353495509539,0.337868800453146,0.935056161618261,0.995990698305442,0.708156967712584,0.360090050222732,-0.633413375613158,0.478731271474313,0.885658390574410,1.00091234523360,0.435466345536268,-0.0268963058545390,0.954540034006203,0.568530030181639,1.56801539628204,-0.115793411752521,0.425814745602368,0.793757171575809,1.13125216944274,0.628761535611526,-0.327226756984036,1.00952896140350,0.689707713249610,0.229606066101782,0.372094762971963,0.489551422172215,-0.668623044074551,2.04359073447812,0.640753237065811,-1.90138271094931,-1.05947096300237,0.691051028327740,1.52672736732834,5.41054329639654,0.594210344435027,1.62872665031978,-0.663655935487016,0.676372497184467,-0.109342916177558,1.22143679483753,0.506375093095781,1.56421214068003,1.17314726473008,0.817804531630193,-1.30444257383263,0.989710661169278,0.383687083324569,0.825919863831762,1.88038025981919,0.827035892274831,-1.58485852025018,0.850795925653701,0.556883375727065,2.10387095561781,-2.47519938960305,0.669892984267576,1.51459331521723,0.0399948346160248,0.609683647324179,2.41634189610628,3.59053228290247,0.690411449146251,1.13552893035494,-0.161043112300847,0.396639642882483,0.432114157258487,1.53934964580527,0.858539064231373,1.38652043996272,0.741815264662148,0.825435063216641,1.19491052223318,0.866110030157863,0.525371264619535,1.39087405041983,2.25637970037697,0.803161268674687,2.45843386380980,0.807735044848948;... 
        %1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,0,200;... 
         %0.858711794266743,1.58516274768247,1.52217829684154,1.32013587901379,1.65336510388417,1.36997513998064,1.26570889060282,1.37076625517572,1.32289287509086,1.53345273346735,1.66806401305444,1.41909586866023,1.55603582671208,1.60582607204206,1.31829251171095,1.65572531194707,1.34964021368868,1.83706536536762,1.27950635230087,1.87195657355420,1.43935134993579,1.59800606285454,1.45159244860837,1.59890235910206,1.31684003911643,1.98417352114091,1.81448389847924,1.46631716230076,1.58856793725250,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.00227818796047904,0.405219581056559,0.477401626204552,0.991660006047077,1,0.248878692332431,0.384835559395091,1,0.449516419677546,0.280850198471569,0.929360229902333,0.723870189358567,0.354964942967314,0.997923506006935,0.599248537191506,0.127725532507673,1,0.477128233111205,0.354989257407438,0.929522740933335,0.387380416979878,0.929278654531283,0.929375004207447,0.537113416555076,0.163725513512495,0.929403140131918,0.420349594967054,0.213572906658643,0.929403146590179,0.404219580062609,0.304015656831632,1,0.391661908383904,0.997941230234331,0.929403365755436,0.443430584667767,0.855113497214769,0.929402928745724,0.796340693142313,0.997941231116052,0.929374427387328,0.556439953920094,0.991661030610415,1,0.477209391126482,0.910947214372719,0.929360764975169,0.452386699110790,0.929292388011704,0.929366326529636,0.527606642564603,0.991659780287932,0.911006348814644,0.473546650422313,0.910958726329835,0.929405100809153,0.402582313863549,0.299155430209692,1,0.634602702793489,-0.0134951472636849,0.929404660787537,0.870434943982690,0.991660005241089,1,0.463843347599410,0.910960058998650,1,0.832911311738218,0.991660005793218,1,0.435811979796530,0.116098984723475,1,0.969345626276428,0.157869405813615,1,0.665161711868863,0.280832615772212,0.929380509652299,0.358934606834333,0.139598164481791,1,0.991660081264776,0.991660005312227,1,0.474696044525772,0.929386058728087,0.929211482345654,0.933389593814475,1,1,0.359715167381569,0.843563476745466,0.929351190130117,0.567777713245800,1,0.843889734296582,0.382875447590349,1,0.929232721069319,0.347733071070219,0.929399636683461,1,0.369646878493419,1,1,0.362458176470740,1,0.843299202802788,0.439123240020890,1,0.990372940606956,0.557139300894743,1,0.929363675116488,0.386281366055554,1,0.843523762364287,0.452385293724819,1,1,0.527631675484074,0.843574669851019,1,0.385419688172369,1,0.843696078784189,0.528048346320645,0.929392660500033,1,0.366422252940650,1,0.0529736233654365,0.682472552415152,1,1,0.334127059637507,1,1,0.679420057857519,0.843857697749374,1,0.443221209984844,1,0.843289564872297,0.540267194894923,1,1,0.403113281999358,0.929359305940531,1,0.552386232785596,1,1,0.355159463584403,1,1,0.730906576234573,0.929422601924214,0.929373042536866,0.639340904068732,0.929403553116460,0.929303053529671,0.624351433652119,0.990377092850589,1,0.549525957502800,1,1,0.731655907663726,1,0.225054428354511,0.276078110344547,0.929388541770180,0.843791859111061,0.568339988101385,1,1,0.768162837892730,1,0.843800061617364,0.607921421958580,1,0.843803105630225,0.544504863052805,1,0.843778051108241,0.609429593855481,1,0.843773261326436,0.570988288512798,1,0.843641269524463,0.707358074058272,1,0.843777543429848,0.765130137961353,1,1,0.647366391599779,1,0.843773721115474,0.732873895092481,0.843817760503005,0.843780099955597,0.782166692235702,0.843755324214658,1,0.586044417675468,1,0.843817072621052,0.772863162380336,0.843670045443966,1,0.603618555046806,0.843693226816690,0.843790099821645,0.937237016883353,1,0.843802666759780,0.543696303814833,0.843780892401573,0.843790096043262,0.895332723808116,1,0.843777451782368,0.654876797610386,1,0.843808025466863,0.771146498654532,1,0.843797576678992,0.664486864489188,0.843668126834934,0.843789800826477,0.741225650777369,1,0.843798267125005,0.568570919022342,0.0539493124332025,0.843806279647044,0.968598841651336,0.843856996479829,0.224833159498468,1,1,1,0.609371505892106,1,1,0.736185579879177,0.843766517078128,1,0.583080642959268,0.843691718227237,0.195041568026696,0.990374734985474,0.990376591507766,0.990376591382206,0.472248681212475,0.843681352715717,1,0.833624241272846,0.843665988548993,0.843670682865463,0.536049175098245,0.843686753078995,1,0.376760620968715,0.843686210238435,0.843671025320834,0.462473816119460,0.990376591260299,0.843687181617940,0.489937184312084,0.843664357665644,0.843689757881888,0.511243781166257,0.843688461762019,0.843675324482447,0.772551403086550,0.0537738458668228,0.843686062413385,0.452859059414895,0.843689001415664,0.843674724671180,0.511295817806638,0.843694014828934,1,0.684764560375910,0.990376592262645,0.843673511204789,0.404929110276637,0.843687367165233,0.843692122132040,0.592097484220613,0.843688943267254,1,0.423420990694423,0.843689052379986,1,0.576727099822349,0.990376592304196,0.843685297044370,0.488902849158420,0.843683998402262,0.843687819523967,0.564608944502796,0.990376590216320,0.843672225558679,0.625463571021922,0.843673193131310,1,0.736100821404527,0.843674787890313,0.843673565825372,0.480367896840074,0.195049311666072,0.843677667284607,0.827216654062449,0.990376592633146,0.843672419358875,0.465854022586545,0.0537372044874069,1,0.847860414552030,0.929369491185872,0.0537359989884265,0.856465983732952,0.990376590217886,0.843667692991153,0.777916233238395,0.990376590688576,0.843689530465880,0.806074066627116,0.195039468076964,0.843673277152375;...
         %        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.1,200;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.2,200;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.3,200;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.4,200;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.5,200;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.6,200;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.7,200;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.1,400;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.2,400;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.3,400;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.4,400;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.5,400;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.6,400;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.7,400;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.1,800;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.2,800;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.3,800;...
%        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.4,800;...
        ];
   
%% Jacobian Pattern
jacpat_int = cell(T*N,1);
[jacpat_int{:}] = deal(sparse(ones(28*3)));
jacpat = horzcat(sparse(ones(28*3*T*N,60)),blkdiag(jacpat_int{:}));

options=optimset('Display','iter','Algorithm','interior-point','JacobPattern',jacpat,'TolCon',1e-2,'TolX',1e-15,'TolFun',1e-2,'SubProblemAlgorithm','cg','Hessian','bfgs');

[X,fval,exitflag] = ktrlink(@(x) resid_MPEC(x,ca,ce,scl,N,T),pop',[],[],[],[],...
    [zeros(28,1);ones(28,1);0;1;ones(28*3*T*N,1)*-20],[ones(28,1)*2;ones((size(pop,2)-2)/2,1)*1000;3000;1;ones(28*3*T*N,1)*20],...
    @(x) mpec_err(x,price,egr,v,w,scl,s,N,T),options);   
% options=gaoptimset('Display','iter','PopulationSize',30,'Generations',150,... 
%    'StallTimeLimit',86400,'TimeLimit',Inf,'MutationFcn',@mutationadaptfeasible,...
%    'FitnessScalingFcn',@fitscalingrank,'InitialPopulation',pop,'UseParallel','always',...
%    'PlotFcns',@gaplotbestf,'EliteCount',1);
% 
%     [X,fval,exitflag,output,population,scores] = ga(@(X) likelihood(X,price,egr,v,w,ca,egr_cuts),60,...
%     [],[],[],[],[ones(1,29)*1e-12,ones(1,29)*1,0,5e1],[ones(1,29)*2,ones(1,29)*2000,1,5e2],[],options);  

save 2-26-12-2.mat

matlabpool close
diary off



