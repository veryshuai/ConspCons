%temporary main file for conspicuous consumption estimation
clc;
cd '/gpfs/home/dcj138/work/ConspCons/'

warning off all;

%read %create data files

load dat

%open parallel functionality
%if matlabpool('size')<12
%matlabpool open 12
%end

%open diary
diary 2-28-12.txt

%linearly extend prices to cover zeros and include only relevant price years
price = price_fixing(price); 
price = price([1,7:12,14:24],:);

%create total expenditures
exp = sum(cons,2);

c = dataset(exp,cons,char);

%drop obs if expenditure less than one dollar/yr
ind = find(exp>1);
less_than_ones = size(exp,1) - size(ind,1);
c = c(ind,:);

%drop obs if any good has negative expenditure
neg_exps = 0;
for k = 1:29
ind = find(c.cons(:,k)>=0);
c = c(ind,:);
neg_exps = neg_exps + size(c.cons(:,k),1)-size(ind,1);
end
display(['Lost ', num2str(less_than_ones), ' expenditures less than one dollar, and further lost ', num2str(neg_exps),' negative expenditure observations']); 

%create year numbers
c.y = zeros(size(c.exp));
c.y(c.char(:,7)==80) = 1;
for k = 2:7
    c.y(c.char(:,7)==84+k) = k;
end
for k = 8:14
    c.y(c.char(:,7)==85+k) = k;
end
for k = 15:18
    c.y(c.char(:,7)==k-15) = k;
end

% create expenditure grid by year [year,grid]
gr_siz = 15;
w_b = zeros(2,18);
egr = cell(18,1);
for k = 1:18
w_b(:,k) = quantile(c.exp(c.y==k),[.1;.2]);
%egr(k,:) = logspace(log(w_b(1,k))/log(10),log(w_b(2,k))/log(10),gr_siz); %logs
egr{k} = linspace(w_b(1,k),w_b(2,k),gr_siz); %linear
end

%create type indices
ti = zeros(size(c,1),4);
ti(:,1) = c.char(:,3)==1 & c.char(:,4) == 1; %bo4
ti(:,2) = c.char(:,3)==1 & c.char(:,4) == 0; %no4
ti(:,3) = c.char(:,3)==0 & c.char(:,4) == 1; %bu4
ti(:,4) = c.char(:,3)==0 & c.char(:,4) == 0; %nu4

%make a type variable
c.type = ti(:,1)+2*ti(:,2) +3*ti(:,3)+4*ti(:,4); 

%create two dimensional consumption array with dimensions year, type, and
%element expenditure share
c = sortrows(c,{'exp'});
ca = cell(18,4);
ce = cell(18,4);
for k = 1:18
    for m = 1:4
       ind = find(c.y==k & c.type==m & c.exp >= w_b(1,k) & c.exp <= w_b(2,k));
        ca{k,m} = c.cons(ind,:)./repmat(c.exp(ind),1,29);
        ce{k,m} = c.exp(ind);
    end
end

%wealth dist calculations, matrix [density,year,type]
% w = zeros(size(egr,2),18,4);
% for j = 1:18
%     for k = 1:4  
%         w(:,j,k) = histc(ce{j,k},egr(j,:))+1e-6; %added a bit to ensure that there are no zeros (full support)
%         w(:,j,k) = w(:,j,k)/sum(w(:,j,k),1); %make it a dist
%     end
% end

%now we need to approximate expenditures with a continuous distribution.
%I choose to fit a polynomial.
w = zeros(4,18,4);
resolution = 30; %number of grid points
freqs = zeros(resolution+1,18,4);
for j = 1:18
    ind_var = linspace(w_b(1,j),w_b(2,j),resolution+1)';
    for k = 1:4
        freqs(:,j,k) = histc(ce{j,k},ind_var);
        w(1:3,j,k) = regress(freqs(1:end-1,j,k),[ind_var(1:end-1).^0,ind_var(1:end-1).^1,ind_var(1:end-1).^2]);
        pred = [ind_var(1:end-1).^0,ind_var(1:end-1).^1,ind_var(1:end-1).^2]*w(1:3,j,k); 
        w(4,j,k) = quad(@(x) w(1,j,k) + w(2,j,k)*x + w(3,j,k)*x.^2,w_b(1,j),w_b(2,j));
    end
end

%v is literally the inverse of the vindex times grid size
v = cell(4,1);
for k = 1:4
    v{k} = vin(k,:).^-1;
end

%Set type number
N = 4;

%set year number
T = 3;

%set scaling for parameters
scl = quantile(c.exp(:),.2)^2;

%Use four-point Gaussian quadrature (weights and points from Wikipedia)
s = cell(T,2);
for t = 1:T
    ow = (egr{t}(end)-egr{t}(1))/2; %outer conversion weight
    iw = (egr{t}(end)+egr{t}(1))/2; %inner conversion weight
    s{t,2} = ow;
    s{t,1} = [ow*[sqrt((3-2*sqrt(6/5))/7);-sqrt((3-2*sqrt(6/5))/7);sqrt((3+2*sqrt(6/5))/7);-sqrt((3+2*sqrt(6/5))/7)]+iw,...
        [(18+sqrt(30))/36;(18+sqrt(30))/36;(18-sqrt(30))/36;(18-sqrt(30))/36]]; %column 1 is evaluation points, column 2 is weights
end

%Sobol version
% sobol_num = 8;
% s = cell(T,1);
% for t = 1:T
%     s{t} = sobolset(1);
%     s{t} = net(s{t},sobol_num);
%     s{t} = egr{t}(1) + (egr{t}(end)-egr{t}(1))*s{t};
%     s{t} = sortrows(s{t});
% end

%set up global distance variable (so I can use parallel)
%global dis 
%dis = zeros(28*3*T*N,1);

    pop = [
         %1.54447903439777,1.35090498391467,1.71215774443687,1.99571402474323,1.59956427070366,1.62990333537302,1.43349917252069,1.61599807942007,1.89624213929275,1.66098877891710,0.989431950197908,1.23980509596797,1.01701377501479,1.67462060190109,1.51144057673234,1.34140602053691,1.31347389253323,1.84232257371854,1.77959246539458,1.84922076404762,1.46794916015857,1.68233352327803,1.47037921706620,1.68965497372164,1.76542216927780,1.98414288985960,1.84862538937963,1.47646744120054,1.90936147698205,1.99756137541823,1.00291957291998,1.99854013426612,1.98773012408360,1.00658066915073,1.00992783438957,1.99510163127061,1.00461488293224,1.99187847011339,1.99284327092363,2.01164880721850,1.99936263434229,1.01173465217151,2.00077500565613,1.03789229361771,1.07271890417482,1.01425497865846,1.99688084024357,1.99306310154848,1.01162819721833,1.03829273760544,1.99320405994165,2.00065424662918,1.99298089170058,1.99371251073292,2.61216685010126,1.99818808734229,1.05190165438408,1.99628691024080,0.113197287991449,0.243412826422788,-0.143109353122232,1.24274502095714,0.978759355566072,0.0533286851845456,0.361363440476037,1.20884965048132,0.368131065099945,0.222431179101056,1.02570143090493,0.0345483226752329,0.658007038275418,1.03865184062610,0.0578895302527899,0.354756919063153,0.553889819609315,-0.269880144742922,0.381857312663827,1.15562873905609,0.0426478573244500,0.774083817892828,0.796132892993759,0.254153069932137,0.0524746404638222,0.805480293314011,0.0586034745091876,0.115363705953246,0.804173901753686,-0.417826832117942,0.368762525689784,1.12323488210978,-0.254467247092692,1.18716035568177,0.990068852835433,-0.411089939786252,0.666272360125503,1.18028986597471,0.0287135444304694,0.895042641848926,0.758737914892543,-0.0782596092514768,1.27745457624036,1.33498453879262,-0.143514426090746,0.938336802443337,0.280017942171674,-0.183532547589751,0.917765877206796,1.05938432242179,0.162946996318822,1.18674348503261,0.850269752345338,0.173693916415967,0.910503061226667,0.968562490005006,0.166792179555094,0.296681072728649,0.636690168954244,-0.0832198938185162,0.0599498631431451,0.526700550295770,0.0810335313404935,0.858681057301290,0.755674674617729,-0.0857682590822649,0.971586244013702,0.516450375711559,0.0774787269209196,0.682708261232628,1.43884945552692,0.168547715369880,0.0313597436771457,1.18538553701278,0.0466625783042915,-0.0531735799396419,0.845140897384135,0.152408327935100,-0.103734232149998,0.850370643106302,-0.144209080958352,0.159466037490574,0.866568836977539,0.209918544833056,0.708222364385790,0.863576483326689,-0.192468536939407,2.12976987460092,0.289282830763791,-0.134289104617116,0.154716386003815,0.999381714271558,0.367265283316788,1.33819478993307,1.23261438044077,-0.124841838577350,0.790274279254423,0.789134073098216,0.0567454624564204,-0.300584890845072,2.33917879758346,-0.329596755201824,0.253593785233492,3.88085497201113,-0.142775742384621,0.836007914079674,0.157345058960241,0.230338329139821,0.915837339241832,0.342912693445439,-0.113007125189593,1.07473150103589,1.97152415254932,-0.431690407931119,0.989862123744413,1.28845125694438,-0.306916429957434,2.28272551805716,-0.379397355515337,-0.352041622821539,1.97170724824648,0.452326334367954,-0.0938467329513327,1.40313136439119,1.08086430232856,-0.226774254382810,-0.447595212902046,1.03944199248298,-0.175387842385941,2.67390452290868,0.496798537236091,-0.234959124962724,0.286585917157684,1.69779988278357,0.0978110773572212,2.04331570057978,-0.379686002159981,0.135243440947481,0.560294484838693,0.998814840605390,0.0891164760163238,1.16621765730185,2.38260392047325,-0.143856990226568,-0.247704950144294,-0.522549805350530,0.0392391914894662,0.379874173935522,-0.366004943714811,-0.139475384229670,0.553937006823907,1.00218914141649,0.0221092299942812,-0.261699158057765,1.91003608362440,0.131703938671409,0.819448435253635,-0.164003638560172,-0.236265992568740,0.121592355567941,0.674258622438856,0.0883810018265194,3.03761815660202,1.53111054133481,-0.157115346763691,1.80296653472805,0.998355910744050,0.139898540072277,-0.691763213396868,0.997799765100640,-0.258242634008486,1.06064462335262,0.241005241367594,0.610634328473931,2.34845125515369,2.55507091331679,0.232077895660953,0.953237162597500,1.00453641227643,2.00396811601158,-0.572775504506041,1.27220125534693,0.218540915775862,2.21075732838307,0.652668011074932,-0.257364050232879,1.17084569872473,2.66393683818336,1.18822962321121,0.118273240508075,2.34321669943230,0.203857293451908,0.418581690745407,1.57399929292222,0.119302952547676,0.839042557533683,1.65997651115495,-0.335612308331859,-0.300833284527368,1.61438427103732,-0.440525087091954,2.43163562239332,1.26071512281767,-0.467632923917958,2.01780063979854,0.393989699193553,0.0804557932890774,0.927220921387201,1.07911389261079,-0.241595454718577,0.332407101436290,0.490200386847502,-0.277844339597666,1.23727598590967,1.18514552824676,-0.413530235327864,2.79095981857526,-1.61021334110114,0.0851371340256563,1.88085500149910,-0.243014572771261,0.0364705846709247,0.219798132269709,0.467401066223431,0.0912421730495570,0.525950799375158,0.430633842904167,-0.546544251587089,-0.452635956409225,1.46191511659248,0.123272966007862,2.07929228250014,0.282188228857519,-0.495828469905154,0.703698303282521,0.517386647742569,0.174407076307457,-0.537990416920113,0.724255646311806,0.126066239658248,-1.20475801660306,0.628270149069416,-0.503290484678807,1.63150777134234,0.265951797193383,0.356845075142463,-2.71130273615517,1.02333034942494,-0.246949047310495,2.39912732077787,0.849435375278039,0.0985699175414592,0.636989624510580,1.00622456299605,-0.187989217748526,-0.138818368926142,1.27253543791993,0.128985121372094,2.07123375961758,1.84252475197790,0.368360327518352,0.939049173087330,0.995929818355728,-0.639743640284997,0.378731406488982,-0.633442710180755,0.187220439601965,0.899358444943677,1.00106721664931,-0.341158582710169,-0.0296374532908222,0.954485038987118,-0.718603127832035,1.57560289031561,-0.113799549949663,0.286736182578409,0.793669493513259,1.13118857795921,-0.506051587399776,-0.306717194791152,1.00946579621842,-2.48124338260514e-05,0.239981927855181,0.368342947887513,-0.369131875259173,-0.670914183779377,2.04445173811030,-0.293748414348049,-1.90034552457013,-1.05936533025640,-0.530028000692723,1.53389675532730,5.41025928225960,-0.298544016941066,1.61765674089918,-0.663669854414629,-0.197491365254731,-0.0857896612570337,1.22137467035313,-0.340188093936813,1.54585389124479,1.17325783566255,0.230339705576606,-1.30987051610662,0.991533295759376,0.191603325414802,0.817935244746254,1.88516195498218,0.0742797707378763,-1.58539353706169,0.856179800294159,-0.363994811460975,2.09952422701923,-2.47506521563510,0.396717575717618,1.51318160964275,0.0378358509618395,-0.355891423057381,2.41552291057632,3.59096808064916,0.348580448319494,1.16061625376247,-0.160770178395780,0.0993807616883239,0.453598796947985,1.52771452009699,-0.694963391987131,1.38702376909677,0.741215036235584,0.000134899823285382,1.17911627403577,0.866050797556824,-0.452435812395579,1.38680369946140,2.25459793815959,0.287328634374393,2.47221574261419,0.806439603604558...
         %-0.143109353122232,1.24274502095714,0.978759355566072,0.0533286851845456,0.361363440476037,1.20884965048132,0.368131065099945,0.222431179101056,1.02570143090493,0.0345483226752329,0.658007038275418,1.03865184062610,0.0578895302527899,0.354756919063153,0.553889819609315,-0.269880144742922,0.381857312663827,1.15562873905609,0.0426478573244500,0.774083817892828,0.796132892993759,0.254153069932137,0.0524746404638222,0.805480293314011,0.0586034745091876,0.115363705953246,0.804173901753686,-0.417826832117942,0.368762525689784,1.12323488210978,-0.254467247092692,1.18716035568177,0.990068852835433,-0.411089939786252,0.666272360125503,1.18028986597471,0.0287135444304694,0.895042641848926,0.758737914892543,-0.0782596092514768,1.27745457624036,1.33498453879262,-0.143514426090746,0.938336802443337,0.280017942171674,-0.183532547589751,0.917765877206796,1.05938432242179,0.162946996318822,1.18674348503261,0.850269752345338,0.173693916415967,0.910503061226667,0.968562490005006,0.166792179555094,0.296681072728649,0.636690168954244,-0.0832198938185162,0.0599498631431451,0.526700550295770,0.0810335313404935,0.858681057301290,0.755674674617729,-0.0857682590822649,0.971586244013702,0.516450375711559,0.0774787269209196,0.682708261232628,1.43884945552692,0.168547715369880,0.0313597436771457,1.18538553701278,0.0466625783042915,-0.0531735799396419,0.845140897384135,0.152408327935100,-0.103734232149998,0.850370643106302,-0.144209080958352,0.159466037490574,0.866568836977539,0.209918544833056,0.708222364385790,0.863576483326689,-0.192468536939407,2.12976987460092,0.289282830763791,-0.134289104617116,0.154716386003815,0.999381714271558,0.367265283316788,1.33819478993307,1.23261438044077,-0.124841838577350,0.790274279254423,0.789134073098216,0.0567454624564204,-0.300584890845072,2.33917879758346,-0.329596755201824,0.253593785233492,3.88085497201113,-0.142775742384621,0.836007914079674,0.157345058960241,0.230338329139821,0.915837339241832,0.342912693445439,-0.113007125189593,1.07473150103589,1.97152415254932,-0.431690407931119,0.989862123744413,1.28845125694438,-0.306916429957434,2.28272551805716,-0.379397355515337,-0.352041622821539,1.97170724824648,0.452326334367954,-0.0938467329513327,1.40313136439119,1.08086430232856,-0.226774254382810,-0.447595212902046,1.03944199248298,-0.175387842385941,2.67390452290868,0.496798537236091,-0.234959124962724,0.286585917157684,1.69779988278357,0.0978110773572212,2.04331570057978,-0.379686002159981,0.135243440947481,0.560294484838693,0.998814840605390,0.0891164760163238,1.16621765730185,2.38260392047325,-0.143856990226568,-0.247704950144294,-0.522549805350530,0.0392391914894662,0.379874173935522,-0.366004943714811,-0.139475384229670,0.553937006823907,1.00218914141649,0.0221092299942812,-0.261699158057765,1.91003608362440,0.131703938671409,0.819448435253635,-0.164003638560172,-0.236265992568740,0.121592355567941,0.674258622438856,0.0883810018265194,3.03761815660202,1.53111054133481,-0.157115346763691,1.80296653472805,0.998355910744050,0.139898540072277,-0.691763213396868,0.997799765100640,-0.258242634008486,1.06064462335262,0.241005241367594,0.610634328473931,2.34845125515369,2.55507091331679,0.232077895660953,0.953237162597500,1.00453641227643,2.00396811601158,-0.572775504506041,1.27220125534693,0.218540915775862,2.21075732838307,0.652668011074932,-0.257364050232879,1.17084569872473,2.66393683818336,1.18822962321121,0.118273240508075,2.34321669943230,0.203857293451908,0.418581690745407,1.57399929292222,0.119302952547676,0.839042557533683,1.65997651115495,-0.335612308331859,-0.300833284527368,1.61438427103732,-0.440525087091954,2.43163562239332,1.26071512281767,-0.467632923917958,2.01780063979854,0.393989699193553,0.0804557932890774,0.927220921387201,1.07911389261079,-0.241595454718577,0.332407101436290,0.490200386847502,-0.277844339597666,1.23727598590967,1.18514552824676,-0.413530235327864,2.79095981857526,-1.61021334110114,0.0851371340256563,1.88085500149910,-0.243014572771261,0.0364705846709247,0.219798132269709,0.467401066223431,0.0912421730495570,0.525950799375158,0.430633842904167,-0.546544251587089,-0.452635956409225,1.46191511659248,0.123272966007862,2.07929228250014,0.282188228857519,-0.495828469905154,0.703698303282521,0.517386647742569,0.174407076307457,-0.537990416920113,0.724255646311806,0.126066239658248,-1.20475801660306,0.628270149069416,-0.503290484678807,1.63150777134234,0.265951797193383,0.356845075142463,-2.71130273615517,1.02333034942494,-0.246949047310495,2.39912732077787,0.849435375278039,0.0985699175414592,0.636989624510580,1.00622456299605,-0.187989217748526,-0.138818368926142,1.27253543791993,0.128985121372094,2.07123375961758,1.84252475197790,0.368360327518352,0.939049173087330,0.995929818355728,-0.639743640284997,0.378731406488982,-0.633442710180755,0.187220439601965,0.899358444943677,1.00106721664931,-0.341158582710169,-0.0296374532908222,0.954485038987118,-0.718603127832035,1.57560289031561,-0.113799549949663,0.286736182578409,0.793669493513259,1.13118857795921,-0.506051587399776,-0.306717194791152,1.00946579621842,-2.48124338260514e-05,0.239981927855181,0.368342947887513,-0.369131875259173,-0.670914183779377,2.04445173811030,-0.293748414348049,-1.90034552457013,-1.05936533025640,-0.530028000692723,1.53389675532730,5.41025928225960,-0.298544016941066,1.61765674089918,-0.663669854414629,-0.197491365254731,-0.0857896612570337,1.22137467035313,-0.340188093936813,1.54585389124479,1.17325783566255,0.230339705576606,-1.30987051610662,0.991533295759376,0.191603325414802,0.817935244746254,1.88516195498218,0.0742797707378763,-1.58539353706169,0.856179800294159,-0.363994811460975,2.09952422701923,-2.47506521563510,0.396717575717618,1.51318160964275,0.0378358509618395,-0.355891423057381,2.41552291057632,3.59096808064916,0.348580448319494,1.16061625376247,-0.160770178395780,0.0993807616883239,0.453598796947985,1.52771452009699,-0.694963391987131,1.38702376909677,0.741215036235584,0.000134899823285382,1.17911627403577,0.866050797556824,-0.452435812395579,1.38680369946140,2.25459793815959,0.287328634374393,2.47221574261419,0.806439603604558...
         %-0.143109353122232,1.24274502095714,0.978759355566072,0.0533286851845456,0.361363440476037,1.20884965048132,0.368131065099945,0.222431179101056,1.02570143090493,0.0345483226752329,0.658007038275418,1.03865184062610,0.0578895302527899,0.354756919063153,0.553889819609315,-0.269880144742922,0.381857312663827,1.15562873905609,0.0426478573244500,0.774083817892828,0.796132892993759,0.254153069932137,0.0524746404638222,0.805480293314011,0.0586034745091876,0.115363705953246,0.804173901753686,-0.417826832117942,0.368762525689784,1.12323488210978,-0.254467247092692,1.18716035568177,0.990068852835433,-0.411089939786252,0.666272360125503,1.18028986597471,0.0287135444304694,0.895042641848926,0.758737914892543,-0.0782596092514768,1.27745457624036,1.33498453879262,-0.143514426090746,0.938336802443337,0.280017942171674,-0.183532547589751,0.917765877206796,1.05938432242179,0.162946996318822,1.18674348503261,0.850269752345338,0.173693916415967,0.910503061226667,0.968562490005006,0.166792179555094,0.296681072728649,0.636690168954244,-0.0832198938185162,0.0599498631431451,0.526700550295770,0.0810335313404935,0.858681057301290,0.755674674617729,-0.0857682590822649,0.971586244013702,0.516450375711559,0.0774787269209196,0.682708261232628,1.43884945552692,0.168547715369880,0.0313597436771457,1.18538553701278,0.0466625783042915,-0.0531735799396419,0.845140897384135,0.152408327935100,-0.103734232149998,0.850370643106302,-0.144209080958352,0.159466037490574,0.866568836977539,0.209918544833056,0.708222364385790,0.863576483326689,-0.192468536939407,2.12976987460092,0.289282830763791,-0.134289104617116,0.154716386003815,0.999381714271558,0.367265283316788,1.33819478993307,1.23261438044077,-0.124841838577350,0.790274279254423,0.789134073098216,0.0567454624564204,-0.300584890845072,2.33917879758346,-0.329596755201824,0.253593785233492,3.88085497201113,-0.142775742384621,0.836007914079674,0.157345058960241,0.230338329139821,0.915837339241832,0.342912693445439,-0.113007125189593,1.07473150103589,1.97152415254932,-0.431690407931119,0.989862123744413,1.28845125694438,-0.306916429957434,2.28272551805716,-0.379397355515337,-0.352041622821539,1.97170724824648,0.452326334367954,-0.0938467329513327,1.40313136439119,1.08086430232856,-0.226774254382810,-0.447595212902046,1.03944199248298,-0.175387842385941,2.67390452290868,0.496798537236091,-0.234959124962724,0.286585917157684,1.69779988278357,0.0978110773572212,2.04331570057978,-0.379686002159981,0.135243440947481,0.560294484838693,0.998814840605390,0.0891164760163238,1.16621765730185,2.38260392047325,-0.143856990226568,-0.247704950144294,-0.522549805350530,0.0392391914894662,0.379874173935522,-0.366004943714811,-0.139475384229670,0.553937006823907,1.00218914141649,0.0221092299942812,-0.261699158057765,1.91003608362440,0.131703938671409,0.819448435253635,-0.164003638560172,-0.236265992568740,0.121592355567941,0.674258622438856,0.0883810018265194,3.03761815660202,1.53111054133481,-0.157115346763691,1.80296653472805,0.998355910744050,0.139898540072277,-0.691763213396868,0.997799765100640,-0.258242634008486,1.06064462335262,0.241005241367594,0.610634328473931,2.34845125515369,2.55507091331679,0.232077895660953,0.953237162597500,1.00453641227643,2.00396811601158,-0.572775504506041,1.27220125534693,0.218540915775862,2.21075732838307,0.652668011074932,-0.257364050232879,1.17084569872473,2.66393683818336,1.18822962321121,0.118273240508075,2.34321669943230,0.203857293451908,0.418581690745407,1.57399929292222,0.119302952547676,0.839042557533683,1.65997651115495,-0.335612308331859,-0.300833284527368,1.61438427103732,-0.440525087091954,2.43163562239332,1.26071512281767,-0.467632923917958,2.01780063979854,0.393989699193553,0.0804557932890774,0.927220921387201,1.07911389261079,-0.241595454718577,0.332407101436290,0.490200386847502,-0.277844339597666,1.23727598590967,1.18514552824676,-0.413530235327864,2.79095981857526,-1.61021334110114,0.0851371340256563,1.88085500149910,-0.243014572771261,0.0364705846709247,0.219798132269709,0.467401066223431,0.0912421730495570,0.525950799375158,0.430633842904167,-0.546544251587089,-0.452635956409225,1.46191511659248,0.123272966007862,2.07929228250014,0.282188228857519,-0.495828469905154,0.703698303282521,0.517386647742569,0.174407076307457,-0.537990416920113,0.724255646311806,0.126066239658248,-1.20475801660306,0.628270149069416,-0.503290484678807,1.63150777134234,0.265951797193383,0.356845075142463,-2.71130273615517,1.02333034942494,-0.246949047310495,2.39912732077787,0.849435375278039,0.0985699175414592,0.636989624510580,1.00622456299605,-0.187989217748526,-0.138818368926142,1.27253543791993,0.128985121372094,2.07123375961758,1.84252475197790,0.368360327518352,0.939049173087330,0.995929818355728,-0.639743640284997,0.378731406488982,-0.633442710180755,0.187220439601965,0.899358444943677,1.00106721664931,-0.341158582710169,-0.0296374532908222,0.954485038987118,-0.718603127832035,1.57560289031561,-0.113799549949663,0.286736182578409,0.793669493513259,1.13118857795921,-0.506051587399776,-0.306717194791152,1.00946579621842,-2.48124338260514e-05,0.239981927855181,0.368342947887513,-0.369131875259173,-0.670914183779377,2.04445173811030,-0.293748414348049,-1.90034552457013,-1.05936533025640,-0.530028000692723,1.53389675532730,5.41025928225960,-0.298544016941066,1.61765674089918,-0.663669854414629,-0.197491365254731,-0.0857896612570337,1.22137467035313,-0.340188093936813,1.54585389124479,1.17325783566255,0.230339705576606,-1.30987051610662,0.991533295759376,0.191603325414802,0.817935244746254,1.88516195498218,0.0742797707378763,-1.58539353706169,0.856179800294159,-0.363994811460975,2.09952422701923,-2.47506521563510,0.396717575717618,1.51318160964275,0.0378358509618395,-0.355891423057381,2.41552291057632,3.59096808064916,0.348580448319494,1.16061625376247,-0.160770178395780,0.0993807616883239,0.453598796947985,1.52771452009699,-0.694963391987131,1.38702376909677,0.741215036235584,0.000134899823285382,1.17911627403577,0.866050797556824,-0.452435812395579,1.38680369946140,2.25459793815959,0.287328634374393,2.47221574261419,0.806439603604558;...
         
         1.49776748312944,1.20916974209177,1.85394489329787,1.99541549527756,1.29319854955698,1.59339474993862,1.21678816840107,1.24520310874827,1.90276407079344,1.07295358014271,1.32926812757898,0.970807269841779,0.978636786592578,1.38677732383689,1.33874184249304,1.07747708509154,1.26625746831496,1.82298005511424,1.61228489481682,1.83639957804601,1.35610218598764,1.82984219752677,1.12968650953949,1.74006462528454,1.58280550956920,1.98232161289792,1.82657422216209,1.49234463526944,1.71848561479427,2.03004856277298,1.00314989229774,1.87295858616223,1.71389703012203,1.00713545893270,1.01066334830590,2.13742970047061,1.00498895091419,1.86613783501859,2.08021796327577,1.84642803339923,1.93476579970935,1.01256449639492,2.46634781139014,1.03907320746308,1.07531722253348,1.01537160051574,1.87485203913603,2.06513965464394,1.01246344407031,1.04119840998314,1.96835909876278,1.89683108160971,1.96212556143719,1.98546356024486,2.77556247884135,2.02505411125772,1.03857055903151,2.09998147099138,0.10350689098167,1321.20115562585,-0.187945800626874,1.25117372098584,0.998145582555624,0.340556624603510,0.365424362327648,1.22107293572816,0.307869624424610,0.240896912949285,1.04504080916435,-0.118811859409696,0.678284707127153,1.04967896445561,0.0610190094741614,0.380057274480716,0.563018921609325,-0.202809630944151,0.386047960335586,1.16537137622147,-0.154936212608180,0.790663004088502,0.794525116853358,0.248882309682427,0.0664164910119893,0.814442173618668,-0.319897570695234,0.109283060860439,0.831940826750489,-0.124451189551136,0.377559210771994,1.12700356042876,-0.435188549469084,1.20039188441543,1.00925192160895,-0.423919321431168,0.687437255399284,1.18028343840389,-0.0882975343832132,0.919266495445017,0.760467806218249,-0.0970996533287862,1.29111665534383,1.34595208373784,-0.308631975619565,0.951651829191160,0.303602475537232,-0.149435349496275,0.927304672394479,1.06814579499383,0.197625909625340,1.18882605228333,0.862071210518846,0.0740770716191842,0.926642102889291,0.980173596981440,0.210615527200929,0.290515933847602,0.648260685076971,-0.0859430772264625,0.0774939467525428,0.555516682782080,0.205663874569528,0.871526087379791,0.744071692600091,-0.244534432918677,0.980859324494441,0.521093535999311,0.156976772391888,0.693054711534458,1.44659603780941,0.0592375567022583,0.0675280390526774,1.19313365820158,-0.147766534611167,-0.0341693068943891,0.863990457647348,0.209037234054052,-0.103666740486549,0.885490234057685,0.0247397581648452,0.177535399637128,0.882407625111720,0.124829088573209,0.729212421734869,0.859044274787343,-0.249756109512574,2.12131156443770,0.309771180585558,0.0952377332788235,0.177726750729876,1.00754522762659,0.252520366110524,1.32179958644966,1.21664948136576,-0.221171982858447,0.841160128497411,0.784478868295929,0.0404176963138568,-0.323178858511819,2.33978916186895,-0.206186158152775,0.299256768676655,3.88616919754517,-0.258862883216786,0.879319570034965,0.125407784929799,0.195741797622426,0.961578152382008,0.354673572861859,-0.456679250163541,1.11684678967053,1.96465226464978,-0.137906888128812,1.02006984358331,1.29734668239254,-0.506675725659926,2.26159879906059,-0.382603079806461,-0.362584709786292,1.91284225814215,0.470116863226944,-0.161959818046149,1.49317832927615,1.08076748203531,-0.150619348758702,-0.431393608690710,1.05826748219682,-0.358793023016807,2.70083129441408,0.461633803815915,-0.208844627021001,0.271144894042941,1.72440604813275,0.175255297735472,2.03556478159937,-0.379295783473727,0.0560600996332261,0.617622105094870,0.979137377592709,0.181678065521772,1.20529937228863,2.39431613002356,-0.138777821016718,-0.300343536200600,-0.576112770274986,0.181728809880991,0.421217679084399,-0.342907862129486,-0.331192275523253,0.578433678080540,0.952377015316426,0.128017606883611,-0.274659871258098,1.90366931143816,0.0305720308030193,0.864917609351123,-0.127052161246042,-0.208212920476770,0.0679477425693008,0.668628284401891,0.146071963349295,3.02911991456219,1.52928267533095,-0.0540543501405847,1.78960934874391,0.986158207898653,0.0935751975656927,-0.764801661744810,1.01910410650708,-0.483394204482131,1.05221097545197,0.245135525182618,1.12288837576709,2.35174455595797,2.55195976123622,0.210513816117809,0.947027560993208,1.00129851781310,2.25302198934309,-0.565646200574253,1.26786862946557,0.491705995987702,2.21147602037760,0.652785067670196,-0.196363119198419,1.16192333024181,2.66600846791639,0.745216435954636,0.123888427492288,2.34709591320668,-0.169356997925545,0.428974221785890,1.57612894659251,0.200244854377786,0.841050372642327,1.65877893465759,-0.317730994784840,-0.295755910899854,1.61539604667822,-0.681233990922690,2.43475899236507,1.25792867301694,-0.557182368790506,2.01894405410754,0.389705735041034,0.215921999203617,0.941302232528393,1.08056343192443,-0.259003088751970,0.336729284631129,0.491149538331031,-1.49652697765944,1.24172841667564,1.18412357177885,-0.494994174456936,2.79500784650302,-1.60783784476200,0.0170771261194104,1.88338005289495,-0.244987759771705,-0.152012329322977,0.225815593677055,0.470373205163123,-0.0514560882140127,0.515258980782752,0.423788125665772,-0.888384519446602,-0.448440800878263,1.46303791899000,0.208469402133037,2.08275464030135,0.283992235790209,-1.74577108723936,0.712702455293355,0.512236164584132,-0.300684261517767,-0.525996569375619,0.722199424598982,0.0951673190493371,-1.19815173142916,0.628675907178800,-0.301224077101390,1.62605624986602,0.264163294859817,0.330352906858976,-2.70596576445010,1.02239509427378,0.0705447663039793,2.40209663502393,0.847060701209552,-0.0239318310869475,0.629924948453299,1.00980835772111,-0.184490503410825,-0.134335909630488,1.27569498708379,0.133339008412239,2.07487626110175,1.84560031447603,0.372544710698040,0.943931530905814,0.999131758097373,-0.635432695443525,0.383126529143576,-0.629966656818193,0.191377058043619,0.903818411497378,1.00568367772602,-0.336647019468072,-0.0268449841940441,0.957693426070825,-0.713584209903495,1.57875097648369,-0.110415763022752,0.289714482282266,0.797020245022888,1.13436965111599,-0.501685885176959,-0.302660755705495,1.01266563571887,0.238927867736146,0.244218379441582,0.373066468433001,-0.364612250218991,-0.668129871519978,2.04749858297046,-0.290223627729772,-1.89581223154299,-1.05580990325017,-0.525741947704700,1.53756681930159,5.41278766727118,-0.294258421701866,1.62167482788244,-0.660188282460110,-0.192640409400924,-0.0814832257185497,1.22407079100002,-0.335249565878493,1.54950410595602,1.17643247274995,0.234506692839286,-1.30528131198964,0.994735918244832,0.194750299670118,0.821804180529525,1.88823140982512,0.0786689208537065,-1.58173505703640,0.859403582029298,-0.358531057024618,2.10335664538948,-2.47145170642838,0.401110382673265,1.51732026007157,0.0411936097707587,-0.352811346880720,2.41886761569729,3.59381119835435,0.352979903624699,1.16325814769350,-0.157378248828446,0.102201431214062,0.457178386765352,1.53045898902862,-0.690392694926940,1.39104667291357,0.745878284316500,0.00285329066738022,1.18233509180704,0.869273026512899,-0.448122822692330,1.39073428117718,2.25761544672610,0.291486337481730,2.47554474188840,0.809671229757028...
         -0.204771259068017,1.09680308391339,-0.0802107726694948,0.799885172021144,-0.221410688848696,1.29588425391627,0.353809859959086,0.137538594412596,1.01662164575851,-0.122462245431047,-0.0168070125737852,0.556147786987928,0.0608655046027205,0.136362950817668,-0.0386161645100512,-0.255333189736937,-0.260001183148127,0.733176565585094,-0.189658802764760,0.578400266870435,0.734036856567444,0.237669592550488,-0.0389669417384947,0.640422248542657,-0.339151926625186,-0.456663558568957,0.782740630610456,-0.131970446137180,0.177194164291606,1.39446753692404,-0.465222151766452,0.522497861927665,0.720849252296063,-0.435297732011197,0.130592991552320,0.788072240387275,-0.119335994943955,0.271485656924293,0.0683800042283856,-0.138296515048313,1.03753487778649,1.49620017512991,-0.330598149385802,0.381231767441010,0.196448363703512,-0.179648312684511,-0.118942296434696,0.427901677435826,0.182375248068999,0.183828520771360,0.158396972123935,0.0945117106159608,0.850940496996215,1.15175476798214,0.212203209342282,-0.302326711639787,0.729111428863324,-0.101071859449528,-0.670350769916929,0.127588469681433,0.191535657637522,-0.190696760320524,1.08002564437877,-0.293079134098566,0.961811567894886,-0.0387931230932271,0.170535117715163,0.626611017831591,1.24562461222662,0.0817832452930239,0.525650663981148,0.683731328855283,0.0115687810489238,-0.436733546390180,0.783754730665506,0.275847031936145,-0.840439303094580,0.583414785276363,0.0589982987682869,-0.539431663715807,0.124642361387149,0.109686807995440,0.488982602389727,0.370398315849540,-0.137593912726721,2.15543378182470,0.351340242817444,0.101479784611831,0.150099838380159,1.05158835884427,0.170688341781663,1.37817399781503,1.27471884960391,-0.113382200041559,0.841740326897216,0.792825834082043,0.144964553509933,-0.307388134790352,2.36676838620612,-0.0692663560224732,0.304708096787666,3.89600064809458,-0.122032264085382,0.877057905897258,0.198577485620880,0.236109337166343,0.966641753620850,0.404673046490217,-0.138473889037332,1.11175622840317,1.99935846073237,-0.266620031018369,0.983764496391330,1.33085882672400,-0.291504800249196,2.28284769243524,-0.317873125664369,-0.306176172205676,2.00395479669018,0.513991266708081,0.0694340418834448,1.44263470170565,1.12902950789604,-0.0253011581974510,-0.454000660592120,1.09198534172584,-0.267621274000208,2.67293984386596,0.558435502664545,-0.0930676295357294,0.279521950410898,1.73512613714561,0.256319713816260,2.06878351588994,-0.317838060779255,0.136286306079684,0.553652637586341,1.05186528838664,0.280598345246923,1.20852566903016,2.40586843244024,0.0119585898438047,-0.252477190767852,-0.468948320228498,0.195094902772839,0.420290995121699,-0.362451503937002,-0.0517643822503669,0.595587566829005,1.05548479842567,0.243070677546980,-0.220780691049713,1.94358705237838,0.103600728159279,0.870821615032446,-0.109656128775056,-0.0467013020464836,0.114748220726544,0.725750922939545,0.217758563623688,3.05547768807459,1.52803438127996,-0.154634397577462,1.80584460596612,0.992004278281900,0.239477574336603,-0.728733707536033,1.05609300409238,-0.258172706415394,1.06028027191045,0.240922670081323,0.610426571143355,2.34763566324884,2.55418130973245,0.231994430530542,0.952909884166179,1.00419143675824,2.00327247165775,-0.572579134866380,1.27176369931745,0.218465498139648,2.20999075945652,0.652444196237902,-0.257304141944493,1.17043891320244,2.66300800701766,1.18781972441850,0.118232722621587,2.34240297534850,0.203799251515586,0.418438239178324,1.57345678294546,0.119264422495610,0.838754633041782,1.65940397213280,-0.335409235133667,-0.300730196974339,1.61382766361277,-0.440401544311780,2.43079029771373,1.26028154854021,-0.467483907845949,2.01710239955286,0.393854681335902,0.0804387886322958,0.926897629500189,1.07874316335301,-0.241567127059405,0.332293193564807,0.490032362927695,-0.277800289088142,1.23685052814679,1.18473812977881,-0.413434381890098,2.78998499673220,-1.60965819050692,0.0851083196552949,1.88020501607234,-0.242931313237229,0.0364507332885017,0.219722827387514,0.467240865760143,0.0911808783958214,0.525765515802703,0.430486256328071,-0.546388222536741,-0.452480825931001,1.46141166403850,0.123246517750740,2.07857231527818,0.282091542674710,-0.495689677457875,0.703456944011940,0.517209293314617,0.174357666238023,-0.537805989014156,0.724007221947917,0.126007091455208,-1.20434383053766,0.628054717447656,-0.503152083989396,1.63094517839538,0.265860676092270,0.356713271042797,-2.71035862529822,1.02297888660071,-0.246929388222695,2.39829154194689,0.849143871570019,0.0985608160125371,0.636771199752859,1.00587900483538,-0.191766516214835,-0.140442783027312,1.26920198655431,0.124802385953454,2.06863362441593,1.83886653892836,0.333637499056536,0.936810097143630,0.991063374907559,-0.659489967591803,0.376886753867064,-0.633260439478976,0.189488042581665,0.898291288565589,1.00091289152452,-0.337585529438989,-0.0247282044056162,0.952189124093720,-0.720414204279318,1.57700577925280,-0.113695938376236,0.299121600431722,0.793643781989361,1.12010726760028,-0.499059772809242,-0.324550912942918,1.00911941591912,-3.36591430614076,0.252931014052584,0.368214725353799,-0.363978886248757,-0.674927275748890,2.03951988182274,-0.290672361382743,-1.90329679212977,-1.05787330985988,-0.524199594430049,1.52847507823864,5.40697382010615,-0.305273431041772,1.60613562191422,-0.663594013825909,-0.193749152308557,-0.0830521003845942,1.21560961409882,-0.336557549037357,1.54890693582090,1.16982900921740,0.231628871860832,-1.30728223118013,0.989085084273219,0.194007559633893,0.801973447802280,1.88207258508194,0.0652263383516664,-1.58701530834139,0.856663744521696,-0.372642475642270,2.09953921757399,-2.47495314957250,0.394746529167147,1.52023663312616,0.0371235001692756,-0.371460825251031,2.41240783960556,3.58917633189531,0.360994005790895,1.16302445096181,-0.161387388510394,0.0933508043660430,0.458610846016570,1.52321625513194,-0.695862705028114,1.39456294457210,0.740939051848545,0.0161736234889771,1.17340819117645,0.858722068950802,-0.446940491913757,1.39415750382963,2.25371398157409,0.289296119789831,2.46747803423226,0.804504289821196...
         -0.207660256417039,1.23595300580877,0.968344753585328,0.240244939746690,0.369797032548149,1.19975387409201,0.296440161518521,0.224133033330565,1.02526694835817,-0.138499602361332,0.648730888732597,1.02846572168512,0.0646037399635837,0.356813790667325,0.553675501242641,-0.223289808521178,0.374733201687508,1.14676416910707,-0.179021753285729,0.766365040433123,0.785869045405540,0.239828216024589,0.0555536912346698,0.805328548004983,-0.335047997905485,0.116466884362168,0.804900043927878,-0.123279366038657,0.370845786848081,1.12280923668611,-0.453925026508693,1.18719903152368,0.989715487215801,-0.424709060129794,0.668648075262591,1.17108034458567,-0.0916366138446900,0.895137524777580,0.748200817757712,-0.110869587847245,1.27772834826151,1.33488714906018,-0.319858819663984,0.938658739076638,0.279799307962191,-0.160804405205557,0.928171169540536,1.05926222613703,0.201394445178150,1.18681353242981,0.850013111385255,0.0671002210754464,0.920766480373185,0.960048894045047,0.211726714263842,0.305157660238017,0.636485927440534,-0.0907285889174910,0.0624399552198029,0.526376991979155,0.207118325159906,0.856493939464099,0.745777058987270,-0.280681817049823,0.961450019937756,0.518499760471351,0.158576978013436,0.671813231833518,1.43990804716750,0.0565447696524987,0.0314911830813704,1.18504117289584,0.0376641811062405,-0.0611968404166912,0.844678934711018,0.201376959891928,-0.103024504696302,0.850335095446340,0.0137877025959804,0.149478192560966,0.866193223487380,0.125502192437105,0.699666096767098,0.863478777838537,-0.215971329282796,2.11917840628627,0.287406366960546,0.810285682505534,0.140848643659970,0.996322686311682,0.265985066665137,1.33373862876775,1.22505828124780,-0.154653912702465,0.770334916140371,0.786483274081882,0.0493690805682924,-0.305193767295526,2.33478380318277,-0.285387375172765,0.245760056970951,3.87207015834067,-0.218594960493083,0.805826471374461,0.140244375958625,0.237504739346327,0.890844697196077,0.342623101200831,-0.376807039970686,1.07312391246127,1.96546071186631,-0.127159401904733,0.982937963400618,1.28536922244032,-0.479952325831215,2.27075049082845,-0.382476277565505,-0.425859399405733,1.95914805784441,0.449758948534235,-0.141477454830887,1.40065415169118,1.07993949233821,-0.162803290446024,-0.458570881567725,1.03641118003167,-0.324145857412585,2.67165601651919,0.495446197633410,-0.185870004304160,0.277655558560298,1.69540486604492,0.166133282781276,2.03298135559246,-0.378752071244754,0.0644700207585864,0.552076682214160,0.998979097115273,0.197899493804634,1.14350235610618,2.38008212190183,-0.103835302728689,-0.255537991870861,-0.525671892586649,0.178844601103379,0.373319114354586,-0.385871661776827,-0.306840618646547,0.545967023256023,1.00256405546854,0.146158025663257,-0.281618462865031,1.90804473467525,0.0571758895447377,0.814224219281909,-0.166036468478267,-0.0252304800260879,0.116298514180638,0.674518519992661,0.249495557980103,3.03311008704161,1.53034791806117,0.0666761119317932,1.79123062665498,0.997233822626035,0.0948198900665702,-0.711906680983433,0.995483997074453,-0.258215426338497,1.06028829028758,0.240931173864984,0.610402283583229,2.34762554730588,2.55418463826475,0.232001465387827,0.952918387679052,1.00419990474593,2.00326124203013,-0.572570631353624,1.27177038553239,0.218438985374881,2.20998001319321,0.652444196237902,-0.257303993088700,1.17042295246060,2.66300800701766,1.18780017273693,0.118208959172414,2.34240660496347,0.203812595394676,0.418446743946453,1.57345678276902,0.119263697342822,0.838730868718641,1.65940397196550,-0.335346921213919,-0.300721687677426,1.61383293243231,-0.440399154373458,2.43078052652616,1.26028154854021,-0.467510115930846,2.01710661466064,0.393863185088732,0.0804612504876725,0.926878855426567,1.07874316309564,-0.241562283196063,0.332301696914574,0.490032362927695,-0.277813408638169,1.23683132181861,1.18473812977881,-0.413472074073978,2.78998804211259,-1.60965819067939,0.0851296524194534,1.88019238631196,-0.242931313514968,0.0364388442809422,0.219699065309780,0.467240865482405,0.0912014532647531,0.525779006158143,0.430486256050334,-0.546387087153524,-0.452504590073312,1.46141166403850,0.123268399059038,2.07857640678607,0.282091542674710,-0.495685835992468,0.703433180320219,0.517209293314617,0.174341234483296,-0.537797484421841,0.724007221947917,0.126023464019332,-1.20433676920881,0.628054717447656,-0.503156521954141,1.63095039014141,0.265860676092270,0.356716223192081,-2.71036554864220,1.02297888660071,-0.246950656069975,2.39829716146418,0.849143871570019,0.0985787990903730,0.636779704400760,1.00587900455936,-0.147264032863793,-0.156847509591111,1.27216600859980,1.16739831298669,2.07627378973347,1.83034667237114,0.588523047361197,0.972363521845531,0.995172544222317,-0.295493396748913,0.319794213159285,-0.655376171350014,0.456017591253263,0.875829975593197,0.980549619361847,-0.157202414344676,-0.0637820894529315,0.954063294204662,-0.453884347111609,1.55909762316950,-0.113138993848154,0.574859832681411,0.821755910813272,1.13143370309220,-0.701635442098355,-0.330704600919698,1.00919614580462,3.54764842534295,0.174602924548849,0.359490777542110,-0.384579997155667,-0.664504653746871,2.04486311843117,-0.168070366622316,-1.90622993658831,-1.05846201672127,-1.45703780693083,1.55497599063101,5.40859456227230,-0.299111179677569,1.60743020844372,-0.664230899475350,-0.691710942397034,-0.0951902363530362,1.22095834961983,-0.0136464504294587,1.53913991372861,1.17287492426339,0.555587403416113,-1.26588816520967,0.982893254868756,0.491642441832008,0.848149711690219,1.88450250847987,0.526030640840874,-1.58730590483682,0.861271879280350,-0.00430469202211305,2.11969225833440,-2.47296492495902,0.665062307148682,1.52086111422480,0.0373986666266498,-0.366680180683474,2.42172311019508,3.59015369513616,0.574004462703030,1.14198347766459,-0.182899534824373,0.479963668627491,0.443999043842986,1.52715315582399,-1.32338651118069,1.38365808212122,0.740941265368114,0.555709098982918,1.21533701823803,0.867744918591449,0.199625106873247,1.38095040717237,2.24967268198602,0.585397035553473,2.47276780765683,0.802193611944369;...
         %0.817206133933687,1.58915404567232,1.58698793163414,1.14380243399119,1.64938322770057,1.32076709318327,1.26594358607647,1.43946738909447,1.24734846885505,1.52559798937732,1.61948801321732,1.33467317754811,1.54329064987771,1.63184917059475,1.47603705164619,1.59671950735345,1.34884944047852,1.84129658974103,1.19932267541589,1.85701047874604,1.41784635491442,1.58691840421046,1.49661213552782,1.62080127816717,1.21138473793763,1.98447677852684,1.85208376316114,1.37224318501192,1.82237593346394,0.990301901657347,1.00288729601342,0.802935687873229,0.995412668461307,1.00650750562058,1.00981531725230,0.979970415273278,1.00456438401385,0.973039693451945,0.997478734095259,0.989369601085482,0.995454734746468,1.01160359547953,0.968694501183257,1.03738713084798,1.07170689688745,1.01409501795020,0.976449242279532,0.991915284850660,1.01149689631704,1.03786230599987,0.963191971334168,0.996035501548351,0.993517354377371,0.971616104323755,0.435707030156423,0.955593329374765,1.03753783667691,0.941642957680005,0.00292739323262019,0.480424140583850,0.670418061827606,1.24517722478501,0.981062963077433,0.672992138891207,0.364944500920036,1.20874957243999,0.338260770618901,0.221355195311438,1.02787611392428,0.708899020492483,0.659810355882155,1.04081944604346,0.478297537277598,0.354161891213899,0.553674162463550,0.435769331934802,0.386483121096072,1.15507892470249,0.571665678069175,0.778204674460036,0.795496254307882,0.426756897235799,0.0569029521876310,0.807970259162437,0.629448759382519,0.119086519128183,0.807963133964888,0.690798560270284,0.368862550727392,1.12523108503629,0.489381340050174,1.19108050140030,0.988960860444712,0.641225088730975,0.670452469454374,1.17961927169794,0.688436423105298,0.898090238697290,0.759544162042033,0.594340517029963,1.28099263122762,1.33455622045235,0.677324853105178,0.942980291891560,0.279387523950965,0.507619502619260,0.922799798239319,1.05603042501923,0.818041602827406,1.19080865852084,0.847416507630558,0.384865066366596,0.913050917287164,0.972137736124902,0.827279270136183,0.298663565618506,0.636728227186840,0.555117686331448,0.0598124192581770,0.529376922325898,0.671106814037196,0.863436577527380,0.758029202690462,0.611479495098432,0.971616601749536,0.515846115442612,0.691898426304148,0.684507797070860,1.43831592929058,0.398070822715963,0.0328302565669299,1.18481024586125,0.836723144625061,-0.0516772264531030,0.847352094272246,0.826189422236424,-0.105512697765214,0.846365408441857,0.526628138232403,0.161486800617738,0.865365078873593,0.801671142283992,0.706276488468212,0.865500728934574,0.670315216946337,2.13013497321703,0.289450662313102,0.673010325955733,0.156605979910572,1.00045562423556,0.338135185840333,1.33884082393192,1.23293311411373,0.708867432361628,0.791945192230439,0.789387828074182,0.478334001453575,-0.298584890985885,2.33907261131221,0.435756504479125,0.254231487680861,3.88062205574044,0.571640022676767,0.839074844899837,0.156788550266895,0.426670739070957,0.915583547374213,0.343200504056374,0.629343066877680,1.07613767478194,1.97102818178135,0.690725477145694,0.993203052662525,1.28885429356975,0.489258221344066,2.28315006534872,-0.378787916669274,0.641086773407572,1.97219587892735,0.452771972083707,0.688367987260099,1.40336152010533,1.08181393547872,0.594488723022758,-0.447659571575859,1.03975220882382,0.677143470205304,2.67389197424791,0.497411201094438,0.507659360900207,0.288100321167706,1.69776347979309,0.817945790854970,2.04343748087757,-0.378988410078666,0.384881052809646,0.561211036929328,0.999982588806336,0.827280324175885,1.16676362974257,2.38227310433526,0.555128422098457,-0.247428724012722,-0.522299076868366,0.671135910797181,0.381298950382990,-0.366271146344651,0.611498550278208,0.556418828037888,1.00156001381339,0.691969497107258,-0.261137147544964,1.91022220974334,0.397976497157354,0.820145417645886,-0.162871003341001,0.836666419128191,0.122025917202171,0.674581711116539,0.825883737272460,3.03769925700234,1.53114828955720,0.526453737957591,1.80423004283615,0.998868137860049,0.801644685077759,-0.680513073034380,0.999594267133113,0.669747744593307,1.05727722512519,0.215548901850032,0.672149144794515,2.33421441259660,2.55464043080821,0.337852299869898,0.941592091104951,0.993976629095979,0.708237809512107,-0.562639444370708,1.24517035787340,0.478563384784418,2.19771732696529,0.649532022472923,0.435309051606011,1.17107648501627,2.65291431757049,0.568679894889826,0.0981901245949871,2.34099366910845,0.425836722726434,0.410268749284230,1.56970875471968,0.628607118629838,0.815054036233338,1.66407388084626,0.689747782505934,-0.313039711394072,1.60551214188975,0.489174713652023,2.42101376562730,1.25593070709514,0.640274930722392,2.01320969570403,0.389157201130293,0.691103158322762,0.927134175211890,1.06919868206772,0.594344873606428,0.312799298565069,0.475979754435316,0.676191447585121,1.23042562488585,1.17863039314645,0.506214585637749,2.78765376592347,-1.61160724113235,0.817415043600388,1.88261836605063,-0.254849202667173,0.383738475227666,0.213542869122029,0.473505582002037,0.826768570044584,0.517755600520325,0.431974277015129,0.557161815977994,-0.479903091682180,1.46457895474592,0.669809862356739,2.07187058694273,0.291461766906170,0.609861338920188,0.702277772458981,0.525578947393398,0.690584553870709,-0.542570279683591,0.760480274761446,0.396807936087706,-1.20805273747624,0.627223707437748,0.858496504668548,1.65859958017339,0.263341347246510,0.825854595034260,-2.71456624840873,0.996805272482457,0.525211233753804,2.39787741637672,0.848255359328492,0.803362925345974,0.627481522541179,0.998065800000515,0.669913078836793,-0.150389628167342,1.27260560334509,0.672320658652798,2.06981678535671,1.84353495509539,0.337868800453146,0.935056161618261,0.995990698305442,0.708156967712584,0.360090050222732,-0.633413375613158,0.478731271474313,0.885658390574410,1.00091234523360,0.435466345536268,-0.0268963058545390,0.954540034006203,0.568530030181639,1.56801539628204,-0.115793411752521,0.425814745602368,0.793757171575809,1.13125216944274,0.628761535611526,-0.327226756984036,1.00952896140350,0.689707713249610,0.229606066101782,0.372094762971963,0.489551422172215,-0.668623044074551,2.04359073447812,0.640753237065811,-1.90138271094931,-1.05947096300237,0.691051028327740,1.52672736732834,5.41054329639654,0.594210344435027,1.62872665031978,-0.663655935487016,0.676372497184467,-0.109342916177558,1.22143679483753,0.506375093095781,1.56421214068003,1.17314726473008,0.817804531630193,-1.30444257383263,0.989710661169278,0.383687083324569,0.825919863831762,1.88038025981919,0.827035892274831,-1.58485852025018,0.850795925653701,0.556883375727065,2.10387095561781,-2.47519938960305,0.669892984267576,1.51459331521723,0.0399948346160248,0.609683647324179,2.41634189610628,3.59053228290247,0.690411449146251,1.13552893035494,-0.161043112300847,0.396639642882483,0.432114157258487,1.53934964580527,0.858539064231373,1.38652043996272,0.741815264662148,0.825435063216641,1.19491052223318,0.866110030157863,0.525371264619535,1.39087405041983,2.25637970037697,0.803161268674687,2.45843386380980,0.807735044848948;... 
        %1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,0,200;... 
         %0.858711794266743,1.58516274768247,1.52217829684154,1.32013587901379,1.65336510388417,1.36997513998064,1.26570889060282,1.37076625517572,1.32289287509086,1.53345273346735,1.66806401305444,1.41909586866023,1.55603582671208,1.60582607204206,1.31829251171095,1.65572531194707,1.34964021368868,1.83706536536762,1.27950635230087,1.87195657355420,1.43935134993579,1.59800606285454,1.45159244860837,1.59890235910206,1.31684003911643,1.98417352114091,1.81448389847924,1.46631716230076,1.58856793725250,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.00227818796047904,0.405219581056559,0.477401626204552,0.991660006047077,1,0.248878692332431,0.384835559395091,1,0.449516419677546,0.280850198471569,0.929360229902333,0.723870189358567,0.354964942967314,0.997923506006935,0.599248537191506,0.127725532507673,1,0.477128233111205,0.354989257407438,0.929522740933335,0.387380416979878,0.929278654531283,0.929375004207447,0.537113416555076,0.163725513512495,0.929403140131918,0.420349594967054,0.213572906658643,0.929403146590179,0.404219580062609,0.304015656831632,1,0.391661908383904,0.997941230234331,0.929403365755436,0.443430584667767,0.855113497214769,0.929402928745724,0.796340693142313,0.997941231116052,0.929374427387328,0.556439953920094,0.991661030610415,1,0.477209391126482,0.910947214372719,0.929360764975169,0.452386699110790,0.929292388011704,0.929366326529636,0.527606642564603,0.991659780287932,0.911006348814644,0.473546650422313,0.910958726329835,0.929405100809153,0.402582313863549,0.299155430209692,1,0.634602702793489,-0.0134951472636849,0.929404660787537,0.870434943982690,0.991660005241089,1,0.463843347599410,0.910960058998650,1,0.832911311738218,0.991660005793218,1,0.435811979796530,0.116098984723475,1,0.969345626276428,0.157869405813615,1,0.665161711868863,0.280832615772212,0.929380509652299,0.358934606834333,0.139598164481791,1,0.991660081264776,0.991660005312227,1,0.474696044525772,0.929386058728087,0.929211482345654,0.933389593814475,1,1,0.359715167381569,0.843563476745466,0.929351190130117,0.567777713245800,1,0.843889734296582,0.382875447590349,1,0.929232721069319,0.347733071070219,0.929399636683461,1,0.369646878493419,1,1,0.362458176470740,1,0.843299202802788,0.439123240020890,1,0.990372940606956,0.557139300894743,1,0.929363675116488,0.386281366055554,1,0.843523762364287,0.452385293724819,1,1,0.527631675484074,0.843574669851019,1,0.385419688172369,1,0.843696078784189,0.528048346320645,0.929392660500033,1,0.366422252940650,1,0.0529736233654365,0.682472552415152,1,1,0.334127059637507,1,1,0.679420057857519,0.843857697749374,1,0.443221209984844,1,0.843289564872297,0.540267194894923,1,1,0.403113281999358,0.929359305940531,1,0.552386232785596,1,1,0.355159463584403,1,1,0.730906576234573,0.929422601924214,0.929373042536866,0.639340904068732,0.929403553116460,0.929303053529671,0.624351433652119,0.990377092850589,1,0.549525957502800,1,1,0.731655907663726,1,0.225054428354511,0.276078110344547,0.929388541770180,0.843791859111061,0.568339988101385,1,1,0.768162837892730,1,0.843800061617364,0.607921421958580,1,0.843803105630225,0.544504863052805,1,0.843778051108241,0.609429593855481,1,0.843773261326436,0.570988288512798,1,0.843641269524463,0.707358074058272,1,0.843777543429848,0.765130137961353,1,1,0.647366391599779,1,0.843773721115474,0.732873895092481,0.843817760503005,0.843780099955597,0.782166692235702,0.843755324214658,1,0.586044417675468,1,0.843817072621052,0.772863162380336,0.843670045443966,1,0.603618555046806,0.843693226816690,0.843790099821645,0.937237016883353,1,0.843802666759780,0.543696303814833,0.843780892401573,0.843790096043262,0.895332723808116,1,0.843777451782368,0.654876797610386,1,0.843808025466863,0.771146498654532,1,0.843797576678992,0.664486864489188,0.843668126834934,0.843789800826477,0.741225650777369,1,0.843798267125005,0.568570919022342,0.0539493124332025,0.843806279647044,0.968598841651336,0.843856996479829,0.224833159498468,1,1,1,0.609371505892106,1,1,0.736185579879177,0.843766517078128,1,0.583080642959268,0.843691718227237,0.195041568026696,0.990374734985474,0.990376591507766,0.990376591382206,0.472248681212475,0.843681352715717,1,0.833624241272846,0.843665988548993,0.843670682865463,0.536049175098245,0.843686753078995,1,0.376760620968715,0.843686210238435,0.843671025320834,0.462473816119460,0.990376591260299,0.843687181617940,0.489937184312084,0.843664357665644,0.843689757881888,0.511243781166257,0.843688461762019,0.843675324482447,0.772551403086550,0.0537738458668228,0.843686062413385,0.452859059414895,0.843689001415664,0.843674724671180,0.511295817806638,0.843694014828934,1,0.684764560375910,0.990376592262645,0.843673511204789,0.404929110276637,0.843687367165233,0.843692122132040,0.592097484220613,0.843688943267254,1,0.423420990694423,0.843689052379986,1,0.576727099822349,0.990376592304196,0.843685297044370,0.488902849158420,0.843683998402262,0.843687819523967,0.564608944502796,0.990376590216320,0.843672225558679,0.625463571021922,0.843673193131310,1,0.736100821404527,0.843674787890313,0.843673565825372,0.480367896840074,0.195049311666072,0.843677667284607,0.827216654062449,0.990376592633146,0.843672419358875,0.465854022586545,0.0537372044874069,1,0.847860414552030,0.929369491185872,0.0537359989884265,0.856465983732952,0.990376590217886,0.843667692991153,0.777916233238395,0.990376590688576,0.843689530465880,0.806074066627116,0.195039468076964,0.843673277152375;...
         %        1.9859,   0.9653,    0.5793,    0.5732,    0.4198,    0.4594,    0.6135,    0.7510,    0.5674,    1.0082,    1.7941,    0.8475,    0.9879,    0.3887,    0.7303,    1.1098,    0.7369,    0.6466,    0.6035,    1.9949,    0.5178,    0.3652,    0.8599,    0.2485,    0.6243,    1.9441,    1.2079,    1.2181,    0.2136, 195.6,	332.4,	1702.6,	595.5,	654.3	,301.8	,105	,1237.7	,1131.9	,1743.2	,202.5	,111.1	,262.7	,959.1	,58.9	,991.3	,467.7	,380.5	,1616.7	,1883.1	,442	,648.4	,712.2	,683.2	,785.4	,996.1	,1721.9	,1772.9	,957,.1,200;... 
         ];
   
%% Jacobian and Hessian Pattern
jacpat_int = cell(T*N,1);
[jacpat_int{:}] = deal(sparse(ones(28*3)));
jacpat = horzcat(sparse(ones(28*3*T*N,60)),blkdiag(jacpat_int{:}));
jacpat = sparse(jacpat);

hesspat = vertcat(sparse(ones(60,28*3*T*N+60)),jacpat); %have no idea if this is correct... 
hesspat = triu(hesspat,0);

%% Call loop
options=optimset('Display','iter','Algorithm','interior-point','JacobPattern',jacpat,'HessPattern',hesspat,'TolCon',1e-2,'TolX',1e-15,'TolFun',1e-2,'SubProblemAlgorithm','cg');%,'Hessian','bfgs');

%get scale
resid_scale = abs(resid_MPEC(pop',ca,ce,scl,N,T,1));
[~,me_scale_inter] = mpec_err(pop',price,egr,v,w,scl,s,N,T,1);
%me_scale = mean(abs(me_scale_inter));
me_scale = 1;

%display([resid_scale,me_scale]);

[X,fval,exitflag] = ktrlink(@(x) resid_MPEC(x,ca,ce,scl,N,T,resid_scale),pop',[],[],[],[],...
    [zeros(28,1);ones(28,1)*0;0;10;ones(28*3*T*N,1)*-inf],[ones(28,1)*inf;ones((size(pop,2)-2)/2,1)*inf;1;inf;ones(28*3*T*N,1)*inf],...
    @(x) mpec_err(x,price,egr,v,w,scl,s,N,T,me_scale),options);   
% options=gaoptimset('Display','iter','PopulationSize',30,'Generations',150,... 
%    'StallTimeLimit',86400,'TimeLimit',Inf,'MutationFcn',@mutationadaptfeasible,...
%    'FitnessScalingFcn',@fitscalingrank,'InitialPopulation',pop,'UseParallel','always',...
%    'PlotFcns',@gaplotbestf,'EliteCount',1);
% 
%     [X,fval,exitflag,output,population,scores] = ga(@(X) likelihood(X,price,egr,v,w,ca,egr_cuts),60,...
%     [],[],[],[],[ones(1,29)*1e-12,ones(1,29)*1,0,5e1],[ones(1,29)*2,ones(1,29)*2000,1,5e2],[],options);  

save 2-28-12.mat

matlabpool close
diary off



